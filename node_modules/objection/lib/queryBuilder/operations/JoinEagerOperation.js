'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _keys = require('babel-runtime/core-js/object/keys');

var _keys2 = _interopRequireDefault(_keys);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _create = require('babel-runtime/core-js/object/create');

var _create2 = _interopRequireDefault(_create);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _EagerOperation2 = require('./EagerOperation');

var _EagerOperation3 = _interopRequireDefault(_EagerOperation2);

var _ValidationError = require('../../ValidationError');

var _ValidationError2 = _interopRequireDefault(_ValidationError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var columnInfo = (0, _create2.default)(null);
var idLengthLimit = 63;
var relationRecursionLimit = 64;

var JoinEagerOperation = function (_EagerOperation) {
  (0, _inherits3.default)(JoinEagerOperation, _EagerOperation);

  function JoinEagerOperation(name, opt) {
    (0, _classCallCheck3.default)(this, JoinEagerOperation);

    var _this = (0, _possibleConstructorReturn3.default)(this, _EagerOperation.call(this, name, opt));

    _this.allRelations = null;
    _this.rootModelClass = null;
    _this.pathInfo = (0, _create2.default)(null);
    _this.encodings = (0, _create2.default)(null);
    _this.decodings = (0, _create2.default)(null);
    _this.encIdx = 0;
    _this.opt = _lodash2.default.defaults(opt, {
      minimize: false,
      separator: ':',
      aliases: {}
    });
    return _this;
  }

  JoinEagerOperation.prototype.clone = function clone() {
    var copy = _EagerOperation.prototype.clone.call(this);

    copy.allRelations = this.allRelations;
    copy.allModelClasses = this.allModelClasses;
    copy.rootModelClass = this.rootModelClass;
    copy.pathInfo = this.pathInfo;
    copy.encodings = this.encodings;
    copy.decodings = this.decodings;
    copy.encIdx = this.encIdx;

    return this;
  };

  JoinEagerOperation.prototype.call = function call(builder, args) {
    var ret = _EagerOperation.prototype.call.call(this, builder, args);
    var ModelClass = builder.modelClass();

    if (ret) {
      this.rootModelClass = ModelClass;
      this.allModelClasses = findAllModels(this.expression, ModelClass);
      this.allRelations = findAllRelations(this.expression, ModelClass);
    }

    return ret;
  };

  JoinEagerOperation.prototype.onBeforeInternal = function onBeforeInternal(builder) {
    return fetchColumnInfo(builder, this.allModelClasses);
  };

  JoinEagerOperation.prototype.onBeforeBuild = function onBeforeBuild(builder) {
    var builderClone = builder.clone();

    builder.table(this.rootModelClass.tableName + ' as ' + this.rootModelClass.tableName);
    builder.findOptions({ callAfterGetDeeply: true });

    this.build({
      expr: this.expression,
      builder: builder,
      modelClass: builder.modelClass(),
      parentInfo: null,
      relation: null,
      path: '',
      selectFilter: function selectFilter(col) {
        return builderClone.hasSelection(col);
      }
    });
  };

  JoinEagerOperation.prototype.onRawResult = function onRawResult(builder, rows) {
    if (_lodash2.default.isEmpty(rows)) {
      return rows;
    }

    var keyInfoByPath = this.createKeyInfo(rows);
    var pathInfo = _lodash2.default.values(this.pathInfo);

    var tree = (0, _create2.default)(null);
    var stack = (0, _create2.default)(null);

    for (var i = 0, lr = rows.length; i < lr; ++i) {
      var row = rows[i];
      var curBranch = tree;

      for (var j = 0, lp = pathInfo.length; j < lp; ++j) {
        var pInfo = pathInfo[j];
        var id = pInfo.idGetter(row);

        if (!id) {
          break;
        }

        if (pInfo.relation) {
          var parentModel = stack[pInfo.encParentPath];

          curBranch = pInfo.getBranch(parentModel);

          if (!curBranch) {
            curBranch = pInfo.createBranch(parentModel);
          }
        }

        var model = pInfo.getModelFromBranch(curBranch, id);

        if (!model) {
          model = createModel(row, pInfo, keyInfoByPath);
          pInfo.setModelToBranch(curBranch, id, model);
        }

        stack[pInfo.encPath] = model;
      }
    }

    return this.finalize(pathInfo[0], _lodash2.default.values(tree));
  };

  JoinEagerOperation.prototype.createKeyInfo = function createKeyInfo(rows) {
    var keys = (0, _keys2.default)(rows[0]);
    var keyInfo = [];

    for (var i = 0, l = keys.length; i < l; ++i) {
      var key = keys[i];
      var sepIdx = key.lastIndexOf(this.sep);

      if (sepIdx === -1) {
        var pInfo = this.pathInfo[''];
        var col = key;

        if (!pInfo.omitCols[col]) {
          keyInfo.push({
            pInfo: pInfo,
            key: key,
            col: col
          });
        }
      } else {
        var encPath = key.substr(0, sepIdx);
        var path = this.decode(encPath);
        var _col = key.substr(sepIdx + 1);
        var _pInfo = this.pathInfo[path];

        if (!_pInfo.omitCols[_col]) {
          keyInfo.push({
            pInfo: _pInfo,
            key: key,
            col: _col
          });
        }
      }
    }

    return _lodash2.default.groupBy(keyInfo, function (kInfo) {
      return kInfo.pInfo.encPath;
    });
  };

  JoinEagerOperation.prototype.finalize = function finalize(pInfo, models) {
    var relNames = (0, _keys2.default)(pInfo.children);

    if (Array.isArray(models)) {
      for (var m = 0, lm = models.length; m < lm; ++m) {
        this.finalizeOne(pInfo, relNames, models[m]);
      }
    } else {
      this.finalizeOne(pInfo, relNames, models);
    }

    return models;
  };

  JoinEagerOperation.prototype.finalizeOne = function finalizeOne(pInfo, relNames, model) {
    for (var r = 0, lr = relNames.length; r < lr; ++r) {
      var relName = relNames[r];
      var branch = model[relName];
      var childPathInfo = pInfo.children[relName];

      var finalized = childPathInfo.finalizeBranch(branch, model);
      this.finalize(childPathInfo, finalized);
    }
  };

  JoinEagerOperation.prototype.build = function build(_ref) {
    var _this2 = this;

    var expr = _ref.expr;
    var builder = _ref.builder;
    var selectFilter = _ref.selectFilter;
    var modelClass = _ref.modelClass;
    var relation = _ref.relation;
    var path = _ref.path;
    var parentInfo = _ref.parentInfo;

    var info = this.createPathInfo({
      modelClass: modelClass,
      path: path,
      relation: relation,
      parentInfo: parentInfo
    });

    this.pathInfo[path] = info;

    this.buildSelects({
      builder: builder,
      selectFilter: selectFilter,
      modelClass: modelClass,
      relation: relation,
      info: info
    });

    forEachExpr(expr, modelClass, function (childExpr, relation) {
      var nextPath = _this2.joinPath(path, relation.name);
      var encNextPath = _this2.encode(nextPath);
      var encJoinTablePath = relation.joinTable ? _this2.encode(joinTableForPath(nextPath)) : null;

      var filterQuery = createFilterQuery({
        builder: builder,
        relation: relation,
        expr: childExpr
      });

      var relatedJoinSelectQuery = createRelatedJoinFromQuery({
        filterQuery: filterQuery,
        relation: relation,
        allRelations: _this2.allRelations
      });

      relation.join(builder, {
        joinOperation: 'leftJoin',
        ownerTable: info.encPath,
        relatedTableAlias: encNextPath,
        joinTableAlias: encJoinTablePath,
        relatedJoinSelectQuery: relatedJoinSelectQuery
      });

      // Apply relation.modify since it may also contains selections. Don't move this
      // to the createFilterQuery function because relatedJoinSelectQuery is cloned
      // From the return value of that function and we don't want relation.modify
      // to be called twice for it.
      filterQuery.modify(relation.modify);

      _this2.build({
        expr: childExpr,
        builder: builder,
        modelClass: relation.relatedModelClass,
        relation: relation,
        parentInfo: info,
        path: nextPath,
        selectFilter: function selectFilter(col) {
          return filterQuery.hasSelection(col);
        }
      });
    });
  };

  JoinEagerOperation.prototype.createPathInfo = function createPathInfo(_ref2) {
    var modelClass = _ref2.modelClass;
    var path = _ref2.path;
    var relation = _ref2.relation;
    var parentInfo = _ref2.parentInfo;

    var encPath = this.encode(path);
    var info = void 0;

    if (relation && relation.isOneToOne()) {
      info = new OneToOnePathInfo();
    } else {
      info = new PathInfo();
    }

    info.path = path;
    info.encPath = encPath;
    info.parentPath = parentInfo && parentInfo.path;
    info.encParentPath = parentInfo && parentInfo.encPath;
    info.modelClass = modelClass;
    info.relation = relation;
    info.idGetter = this.createIdGetter(modelClass, encPath);

    if (parentInfo) {
      parentInfo.children[relation.name] = info;
    }

    return info;
  };

  JoinEagerOperation.prototype.buildSelects = function buildSelects(_ref3) {
    var _this3 = this;

    var builder = _ref3.builder;
    var selectFilter = _ref3.selectFilter;
    var modelClass = _ref3.modelClass;
    var relation = _ref3.relation;
    var info = _ref3.info;

    var selects = [];
    var idCols = modelClass.getIdColumnArray();
    var rootTable = this.rootModelClass.tableName;

    columnInfo[modelClass.tableName].columns.forEach(function (col) {
      var filterPassed = selectFilter(col);
      var isIdColumn = idCols.indexOf(col) !== -1;

      if (filterPassed || isIdColumn) {
        selects.push({
          col: (info.encPath || rootTable) + '.' + col,
          alias: _this3.joinPath(info.encPath, col)
        });

        if (!filterPassed) {
          info.omitCols[col] = true;
        }
      }
    });

    if (relation && relation.joinTableExtraCols) {
      (function () {
        var joinTable = _this3.encode(joinTableForPath(info.path));

        relation.joinTableExtraCols.forEach(function (col) {
          if (selectFilter(col)) {
            selects.push({
              col: joinTable + '.' + col,
              alias: _this3.joinPath(info.encPath, col)
            });
          }
        });
      })();
    }

    var tooLongAliases = selects.filter(function (select) {
      return select.alias.length > idLengthLimit;
    });

    if (tooLongAliases.length) {
      throw new _ValidationError2.default({
        eager: 'identifier ' + tooLongAliases[0].alias + ' is over ' + idLengthLimit + ' characters long ' + 'and would be truncated by the database engine.'
      });
    }

    builder.select(selects.map(function (select) {
      return select.col + ' as ' + select.alias;
    }));
  };

  JoinEagerOperation.prototype.encode = function encode(path) {
    var _this4 = this;

    if (!this.opt.minimize) {
      var encPath = this.encodings[path];

      if (!encPath) {
        var parts = path.split(this.sep);

        // Don't encode the root.
        if (!path) {
          encPath = path;
        } else {
          encPath = parts.map(function (part) {
            return _this4.opt.aliases[part] || part;
          }).join(this.sep);
        }

        this.encodings[path] = encPath;
        this.decodings[encPath] = path;
      }

      return encPath;
    } else {
      var _encPath = this.encodings[path];

      if (!_encPath) {
        // Don't encode the root.
        if (!path) {
          _encPath = path;
        } else {
          _encPath = this.nextEncodedPath();
        }

        this.encodings[path] = _encPath;
        this.decodings[_encPath] = path;
      }

      return _encPath;
    }
  };

  JoinEagerOperation.prototype.decode = function decode(path) {
    return this.decodings[path];
  };

  JoinEagerOperation.prototype.nextEncodedPath = function nextEncodedPath() {
    return '_t' + ++this.encIdx;
  };

  JoinEagerOperation.prototype.createIdGetter = function createIdGetter(modelClass, path) {
    var _this5 = this;

    var idCols = modelClass.getIdColumnArray().map(function (col) {
      return _this5.joinPath(path, col);
    });

    if (idCols.length === 1) {
      return createSingleIdGetter(idCols);
    } else if (idCols.length === 2) {
      return createTwoIdGetter(idCols);
    } else if (idCols.length === 3) {
      return createThreeIdGetter(idCols);
    } else {
      return createNIdGetter(idCols);
    }
  };

  JoinEagerOperation.prototype.joinPath = function joinPath(path, nextPart) {
    if (path) {
      return '' + path + this.sep + nextPart;
    } else {
      return nextPart;
    }
  };

  (0, _createClass3.default)(JoinEagerOperation, [{
    key: 'sep',
    get: function get() {
      return this.opt.separator;
    }
  }]);
  return JoinEagerOperation;
}(_EagerOperation3.default);

exports.default = JoinEagerOperation;


function findAllModels(expr, modelClass) {
  var models = [];

  findAllModelsImpl(expr, modelClass, models);

  return _lodash2.default.uniqBy(models, 'tableName');
}

function findAllModelsImpl(expr, modelClass, models) {
  models.push(modelClass);

  forEachExpr(expr, modelClass, function (childExpr, relation) {
    findAllModelsImpl(childExpr, relation.relatedModelClass, models);
  });
}

function findAllRelations(expr, modelClass) {
  var relations = [];

  findAllRelationsImpl(expr, modelClass, relations);

  return _lodash2.default.uniqWith(relations, function (lhs, rhs) {
    return lhs === rhs;
  });
}

function findAllRelationsImpl(expr, modelClass, relations) {
  forEachExpr(expr, modelClass, function (childExpr, relation) {
    relations.push(relation);

    findAllRelationsImpl(childExpr, relation.relatedModelClass, relations);
  });
}

function fetchColumnInfo(builder, models) {
  var knex = builder.knex();

  return _bluebird2.default.all(models.map(function (ModelClass) {
    var table = ModelClass.tableName;

    if (columnInfo[table]) {
      return columnInfo[table];
    } else {
      columnInfo[table] = knex(table).columnInfo().then(function (info) {
        var result = {
          columns: (0, _keys2.default)(info)
        };

        columnInfo[table] = result;
        return result;
      });

      return columnInfo[table];
    }
  }));
}

function forEachExpr(expr, modelClass, callback) {
  var relations = modelClass.getRelations();
  var relNames = (0, _keys2.default)(relations);

  if (expr.isAllRecursive() || expr.maxRecursionDepth() > relationRecursionLimit) {
    throw new _ValidationError2.default({
      eager: 'recursion depth of eager expression ' + expr.toString() + ' too big for JoinEagerAlgorithm'
    });
  }

  for (var i = 0, l = relNames.length; i < l; ++i) {
    var relName = relNames[i];
    var relation = relations[relName];
    var childExpr = expr.childExpression(relation.name);

    if (childExpr) {
      callback(childExpr, relation, relName);
    }
  }
}

function createSingleIdGetter(idCols) {
  var idCol = idCols[0];

  return function (row) {
    var val = row[idCol];

    if (!val) {
      return null;
    } else {
      return val;
    }
  };
}

function createTwoIdGetter(idCols) {
  var idCol1 = idCols[0];
  var idCol2 = idCols[1];

  return function (row) {
    var val1 = row[idCol1];
    var val2 = row[idCol2];

    if (!val1 || !val2) {
      return null;
    } else {
      return val1 + ',' + val2;
    }
  };
}

function createThreeIdGetter(idCols) {
  var idCol1 = idCols[0];
  var idCol2 = idCols[1];
  var idCol3 = idCols[2];

  return function (row) {
    var val1 = row[idCol1];
    var val2 = row[idCol2];
    var val3 = row[idCol3];

    if (!val1 || !val2 || !val3) {
      return null;
    } else {
      return val1 + ',' + val2 + ',' + val3;
    }
  };
}

function createNIdGetter(idCols) {
  return function (row) {
    var id = '';

    for (var i = 0, l = idCols.length; i < l; ++i) {
      var val = row[idCols[i]];

      if (!val) {
        return null;
      }

      id += (i > 0 ? ',' : '') + val;
    }

    return id;
  };
}

function createFilterQuery(_ref4) {
  var builder = _ref4.builder;
  var expr = _ref4.expr;
  var relation = _ref4.relation;

  var filterQuery = relation.relatedModelClass.query().childQueryOf(builder);

  for (var i = 0, l = expr.args.length; i < l; ++i) {
    var filterName = expr.args[i];
    var filter = expr.filters[filterName];

    if (typeof filter !== 'function') {
      throw new _ValidationError2.default({ eager: 'could not find filter "' + filterName + '" for relation "' + relation.name + '"' });
    }

    filter(filterQuery);
  }

  return filterQuery;
}

function createRelatedJoinFromQuery(_ref5) {
  var filterQuery = _ref5.filterQuery;
  var relation = _ref5.relation;
  var allRelations = _ref5.allRelations;

  var relatedJoinFromQuery = filterQuery.clone();

  var allForeignKeys = findAllForeignKeysForModel({
    modelClass: relation.relatedModelClass,
    allRelations: allRelations
  });

  return relatedJoinFromQuery.select(allForeignKeys.filter(function (col) {
    return !relatedJoinFromQuery.hasSelection(col);
  }));
}

function findAllForeignKeysForModel(_ref6) {
  var modelClass = _ref6.modelClass;
  var allRelations = _ref6.allRelations;

  var foreignKeys = modelClass.getIdColumnArray().slice();

  allRelations.forEach(function (rel) {
    if (rel.relatedModelClass.tableName === modelClass.tableName) {
      rel.relatedCol.forEach(function (col) {
        return foreignKeys.push(col);
      });
    }

    if (rel.ownerModelClass.tableName === modelClass.tableName) {
      rel.ownerCol.forEach(function (col) {
        return foreignKeys.push(col);
      });
    }
  });

  return _lodash2.default.uniq(foreignKeys);
}

function createModel(row, pInfo, keyInfoByPath) {
  var keyInfo = keyInfoByPath[pInfo.encPath];
  var json = {};

  for (var k = 0, lk = keyInfo.length; k < lk; ++k) {
    var kInfo = keyInfo[k];
    json[kInfo.col] = row[kInfo.key];
  }

  return pInfo.modelClass.fromDatabaseJson(json);
}

function joinTableForPath(path) {
  return path + '_join';
}

var PathInfo = function () {
  function PathInfo() {
    (0, _classCallCheck3.default)(this, PathInfo);

    this.path = null;
    this.encPath = null;
    this.encParentPath = null;
    this.modelClass = null;
    this.relation = null;
    this.omitCols = (0, _create2.default)(null);
    this.children = (0, _create2.default)(null);
    this.idGetter = null;
  }

  PathInfo.prototype.createBranch = function createBranch(parentModel) {
    var branch = (0, _create2.default)(null);
    parentModel[this.relation.name] = branch;
    return branch;
  };

  PathInfo.prototype.getBranch = function getBranch(parentModel) {
    return parentModel[this.relation.name];
  };

  PathInfo.prototype.getModelFromBranch = function getModelFromBranch(branch, id) {
    return branch[id];
  };

  PathInfo.prototype.setModelToBranch = function setModelToBranch(branch, id, model) {
    branch[id] = model;
  };

  PathInfo.prototype.finalizeBranch = function finalizeBranch(branch, parentModel) {
    var relModels = _lodash2.default.values(branch);
    parentModel[this.relation.name] = relModels;
    return relModels;
  };

  return PathInfo;
}();

var OneToOnePathInfo = function (_PathInfo) {
  (0, _inherits3.default)(OneToOnePathInfo, _PathInfo);

  function OneToOnePathInfo() {
    (0, _classCallCheck3.default)(this, OneToOnePathInfo);
    return (0, _possibleConstructorReturn3.default)(this, _PathInfo.apply(this, arguments));
  }

  OneToOnePathInfo.prototype.createBranch = function createBranch(parentModel) {
    return parentModel;
  };

  OneToOnePathInfo.prototype.getBranch = function getBranch(parentModel) {
    return parentModel;
  };

  OneToOnePathInfo.prototype.getModelFromBranch = function getModelFromBranch(branch, id) {
    return branch[this.relation.name];
  };

  OneToOnePathInfo.prototype.setModelToBranch = function setModelToBranch(branch, id, model) {
    branch[this.relation.name] = model;
  };

  OneToOnePathInfo.prototype.finalizeBranch = function finalizeBranch(branch, parentModel) {
    parentModel[this.relation.name] = branch || null;
    return branch || null;
  };

  return OneToOnePathInfo;
}(PathInfo);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkpvaW5FYWdlck9wZXJhdGlvbi5qcyJdLCJuYW1lcyI6WyJjb2x1bW5JbmZvIiwiaWRMZW5ndGhMaW1pdCIsInJlbGF0aW9uUmVjdXJzaW9uTGltaXQiLCJKb2luRWFnZXJPcGVyYXRpb24iLCJuYW1lIiwib3B0IiwiYWxsUmVsYXRpb25zIiwicm9vdE1vZGVsQ2xhc3MiLCJwYXRoSW5mbyIsImVuY29kaW5ncyIsImRlY29kaW5ncyIsImVuY0lkeCIsImRlZmF1bHRzIiwibWluaW1pemUiLCJzZXBhcmF0b3IiLCJhbGlhc2VzIiwiY2xvbmUiLCJjb3B5IiwiYWxsTW9kZWxDbGFzc2VzIiwiY2FsbCIsImJ1aWxkZXIiLCJhcmdzIiwicmV0IiwiTW9kZWxDbGFzcyIsIm1vZGVsQ2xhc3MiLCJmaW5kQWxsTW9kZWxzIiwiZXhwcmVzc2lvbiIsImZpbmRBbGxSZWxhdGlvbnMiLCJvbkJlZm9yZUludGVybmFsIiwiZmV0Y2hDb2x1bW5JbmZvIiwib25CZWZvcmVCdWlsZCIsImJ1aWxkZXJDbG9uZSIsInRhYmxlIiwidGFibGVOYW1lIiwiZmluZE9wdGlvbnMiLCJjYWxsQWZ0ZXJHZXREZWVwbHkiLCJidWlsZCIsImV4cHIiLCJwYXJlbnRJbmZvIiwicmVsYXRpb24iLCJwYXRoIiwic2VsZWN0RmlsdGVyIiwiY29sIiwiaGFzU2VsZWN0aW9uIiwib25SYXdSZXN1bHQiLCJyb3dzIiwiaXNFbXB0eSIsImtleUluZm9CeVBhdGgiLCJjcmVhdGVLZXlJbmZvIiwidmFsdWVzIiwidHJlZSIsInN0YWNrIiwiaSIsImxyIiwibGVuZ3RoIiwicm93IiwiY3VyQnJhbmNoIiwiaiIsImxwIiwicEluZm8iLCJpZCIsImlkR2V0dGVyIiwicGFyZW50TW9kZWwiLCJlbmNQYXJlbnRQYXRoIiwiZ2V0QnJhbmNoIiwiY3JlYXRlQnJhbmNoIiwibW9kZWwiLCJnZXRNb2RlbEZyb21CcmFuY2giLCJjcmVhdGVNb2RlbCIsInNldE1vZGVsVG9CcmFuY2giLCJlbmNQYXRoIiwiZmluYWxpemUiLCJrZXlzIiwia2V5SW5mbyIsImwiLCJrZXkiLCJzZXBJZHgiLCJsYXN0SW5kZXhPZiIsInNlcCIsIm9taXRDb2xzIiwicHVzaCIsInN1YnN0ciIsImRlY29kZSIsImdyb3VwQnkiLCJrSW5mbyIsIm1vZGVscyIsInJlbE5hbWVzIiwiY2hpbGRyZW4iLCJBcnJheSIsImlzQXJyYXkiLCJtIiwibG0iLCJmaW5hbGl6ZU9uZSIsInIiLCJyZWxOYW1lIiwiYnJhbmNoIiwiY2hpbGRQYXRoSW5mbyIsImZpbmFsaXplZCIsImZpbmFsaXplQnJhbmNoIiwiaW5mbyIsImNyZWF0ZVBhdGhJbmZvIiwiYnVpbGRTZWxlY3RzIiwiZm9yRWFjaEV4cHIiLCJjaGlsZEV4cHIiLCJuZXh0UGF0aCIsImpvaW5QYXRoIiwiZW5jTmV4dFBhdGgiLCJlbmNvZGUiLCJlbmNKb2luVGFibGVQYXRoIiwiam9pblRhYmxlIiwiam9pblRhYmxlRm9yUGF0aCIsImZpbHRlclF1ZXJ5IiwiY3JlYXRlRmlsdGVyUXVlcnkiLCJyZWxhdGVkSm9pblNlbGVjdFF1ZXJ5IiwiY3JlYXRlUmVsYXRlZEpvaW5Gcm9tUXVlcnkiLCJqb2luIiwiam9pbk9wZXJhdGlvbiIsIm93bmVyVGFibGUiLCJyZWxhdGVkVGFibGVBbGlhcyIsImpvaW5UYWJsZUFsaWFzIiwibW9kaWZ5IiwicmVsYXRlZE1vZGVsQ2xhc3MiLCJpc09uZVRvT25lIiwiT25lVG9PbmVQYXRoSW5mbyIsIlBhdGhJbmZvIiwicGFyZW50UGF0aCIsImNyZWF0ZUlkR2V0dGVyIiwic2VsZWN0cyIsImlkQ29scyIsImdldElkQ29sdW1uQXJyYXkiLCJyb290VGFibGUiLCJjb2x1bW5zIiwiZm9yRWFjaCIsImZpbHRlclBhc3NlZCIsImlzSWRDb2x1bW4iLCJpbmRleE9mIiwiYWxpYXMiLCJqb2luVGFibGVFeHRyYUNvbHMiLCJ0b29Mb25nQWxpYXNlcyIsImZpbHRlciIsInNlbGVjdCIsImVhZ2VyIiwibWFwIiwicGFydHMiLCJzcGxpdCIsInBhcnQiLCJuZXh0RW5jb2RlZFBhdGgiLCJjcmVhdGVTaW5nbGVJZEdldHRlciIsImNyZWF0ZVR3b0lkR2V0dGVyIiwiY3JlYXRlVGhyZWVJZEdldHRlciIsImNyZWF0ZU5JZEdldHRlciIsIm5leHRQYXJ0IiwiZmluZEFsbE1vZGVsc0ltcGwiLCJ1bmlxQnkiLCJyZWxhdGlvbnMiLCJmaW5kQWxsUmVsYXRpb25zSW1wbCIsInVuaXFXaXRoIiwibGhzIiwicmhzIiwia25leCIsImFsbCIsInRoZW4iLCJyZXN1bHQiLCJjYWxsYmFjayIsImdldFJlbGF0aW9ucyIsImlzQWxsUmVjdXJzaXZlIiwibWF4UmVjdXJzaW9uRGVwdGgiLCJ0b1N0cmluZyIsImNoaWxkRXhwcmVzc2lvbiIsImlkQ29sIiwidmFsIiwiaWRDb2wxIiwiaWRDb2wyIiwidmFsMSIsInZhbDIiLCJpZENvbDMiLCJ2YWwzIiwicXVlcnkiLCJjaGlsZFF1ZXJ5T2YiLCJmaWx0ZXJOYW1lIiwiZmlsdGVycyIsInJlbGF0ZWRKb2luRnJvbVF1ZXJ5IiwiYWxsRm9yZWlnbktleXMiLCJmaW5kQWxsRm9yZWlnbktleXNGb3JNb2RlbCIsImZvcmVpZ25LZXlzIiwic2xpY2UiLCJyZWwiLCJyZWxhdGVkQ29sIiwib3duZXJNb2RlbENsYXNzIiwib3duZXJDb2wiLCJ1bmlxIiwianNvbiIsImsiLCJsayIsImZyb21EYXRhYmFzZUpzb24iLCJyZWxNb2RlbHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0FBRUEsSUFBTUEsYUFBYSxzQkFBYyxJQUFkLENBQW5CO0FBQ0EsSUFBTUMsZ0JBQWdCLEVBQXRCO0FBQ0EsSUFBTUMseUJBQXlCLEVBQS9COztJQUVxQkMsa0I7OztBQUVuQiw4QkFBWUMsSUFBWixFQUFrQkMsR0FBbEIsRUFBdUI7QUFBQTs7QUFBQSwrREFDckIsMkJBQU1ELElBQU4sRUFBWUMsR0FBWixDQURxQjs7QUFHckIsVUFBS0MsWUFBTCxHQUFvQixJQUFwQjtBQUNBLFVB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JztcbmltcG9ydCBQcm9taXNlIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBFYWdlck9wZXJhdGlvbiBmcm9tICcuL0VhZ2VyT3BlcmF0aW9uJztcbmltcG9ydCBWYWxpZGF0aW9uRXJyb3IgZnJvbSAnLi4vLi4vVmFsaWRhdGlvbkVycm9yJztcblxuY29uc3QgY29sdW1uSW5mbyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5jb25zdCBpZExlbmd0aExpbWl0ID0gNjM7XG5jb25zdCByZWxhdGlvblJlY3Vyc2lvbkxpbWl0ID0gNjQ7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEpvaW5FYWdlck9wZXJhdGlvbiBleHRlbmRzIEVhZ2VyT3BlcmF0aW9uIHtcblxuICBjb25zdHJ1Y3RvcihuYW1lLCBvcHQpIHtcbiAgICBzdXBlcihuYW1lLCBvcHQpO1xuXG4gICAgdGhpcy5hbGxSZWxhdGlvbnMgPSBudWxsO1xuICAgIHRoaXMucm9vdE1vZGVsQ2xhc3MgPSBudWxsO1xuICAgIHRoaXMucGF0aEluZm8gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIHRoaXMuZW5jb2RpbmdzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmRlY29kaW5ncyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy5lbmNJZHggPSAwO1xuICAgIHRoaXMub3B0ID0gXy5kZWZhdWx0cyhvcHQsIHtcbiAgICAgIG1pbmltaXplOiBmYWxzZSxcbiAgICAgIHNlcGFyYXRvcjogJzonLFxuICAgICAgYWxpYXNlczoge31cbiAgICB9KTtcbiAgfVxuXG4gIGNsb25lKCkge1xuICAgIGNvbnN0IGNvcHkgPSBzdXBlci5jbG9uZSgpO1xuXG4gICAgY29weS5hbGxSZWxhdGlvbnMgPSB0aGlzLmFsbFJlbGF0aW9ucztcbiAgICBjb3B5LmFsbE1vZGVsQ2xhc3NlcyA9IHRoaXMuYWxsTW9kZWxDbGFzc2VzO1xuICAgIGNvcHkucm9vdE1vZGVsQ2xhc3MgPSB0aGlzLnJvb3RNb2RlbENsYXNzO1xuICAgIGNvcHkucGF0aEluZm8gPSB0aGlzLnBhdGhJbmZvO1xuICAgIGNvcHkuZW5jb2RpbmdzID0gdGhpcy5lbmNvZGluZ3M7XG4gICAgY29weS5kZWNvZGluZ3MgPSB0aGlzLmRlY29kaW5ncztcbiAgICBjb3B5LmVuY0lkeCA9IHRoaXMuZW5jSWR4O1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjYWxsKGJ1aWxkZXIsIGFyZ3MpIHtcbiAgICBjb25zdCByZXQgPSBzdXBlci5jYWxsKGJ1aWxkZXIsIGFyZ3MpO1xuICAgIGNvbnN0IE1vZGVsQ2xhc3MgPSBidWlsZGVyLm1vZGVsQ2xhc3MoKTtcblxuICAgIGlmIChyZXQpIHtcbiAgICAgIHRoaXMucm9vdE1vZGVsQ2xhc3MgPSBNb2RlbENsYXNzO1xuICAgICAgdGhpcy5hbGxNb2RlbENsYXNzZXMgPSBmaW5kQWxsTW9kZWxzKHRoaXMuZXhwcmVzc2lvbiwgTW9kZWxDbGFzcyk7XG4gICAgICB0aGlzLmFsbFJlbGF0aW9ucyA9IGZpbmRBbGxSZWxhdGlvbnModGhpcy5leHByZXNzaW9uLCBNb2RlbENsYXNzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmV0O1xuICB9XG5cbiAgb25CZWZvcmVJbnRlcm5hbChidWlsZGVyKSB7XG4gICAgcmV0dXJuIGZldGNoQ29sdW1uSW5mbyhidWlsZGVyLCB0aGlzLmFsbE1vZGVsQ2xhc3Nlcyk7XG4gIH1cblxuICBvbkJlZm9yZUJ1aWxkKGJ1aWxkZXIpIHtcbiAgICBjb25zdCBidWlsZGVyQ2xvbmUgPSBidWlsZGVyLmNsb25lKCk7XG5cbiAgICBidWlsZGVyLnRhYmxlKGAke3RoaXMucm9vdE1vZGVsQ2xhc3MudGFibGVOYW1lfSBhcyAke3RoaXMucm9vdE1vZGVsQ2xhc3MudGFibGVOYW1lfWApO1xuICAgIGJ1aWxkZXIuZmluZE9wdGlvbnMoe2NhbGxBZnRlckdldERlZXBseTogdHJ1ZX0pO1xuXG4gICAgdGhpcy5idWlsZCh7XG4gICAgICBleHByOiB0aGlzLmV4cHJlc3Npb24sXG4gICAgICBidWlsZGVyOiBidWlsZGVyLFxuICAgICAgbW9kZWxDbGFzczogYnVpbGRlci5tb2RlbENsYXNzKCksXG4gICAgICBwYXJlbnRJbmZvOiBudWxsLFxuICAgICAgcmVsYXRpb246IG51bGwsXG4gICAgICBwYXRoOiAnJyxcbiAgICAgIHNlbGVjdEZpbHRlcjogKGNvbCkgPT4ge1xuICAgICAgICByZXR1cm4gYnVpbGRlckNsb25lLmhhc1NlbGVjdGlvbihjb2wpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgb25SYXdSZXN1bHQoYnVpbGRlciwgcm93cykge1xuICAgIGlmIChfLmlzRW1wdHkocm93cykpIHtcbiAgICAgIHJldHVybiByb3dzO1xuICAgIH1cblxuICAgIGNvbnN0IGtleUluZm9CeVBhdGggPSB0aGlzLmNyZWF0ZUtleUluZm8ocm93cyk7XG4gICAgY29uc3QgcGF0aEluZm8gPSBfLnZhbHVlcyh0aGlzLnBhdGhJbmZvKTtcblxuICAgIGNvbnN0IHRyZWUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIGNvbnN0IHN0YWNrID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBsciA9IHJvd3MubGVuZ3RoOyBpIDwgbHI7ICsraSkge1xuICAgICAgY29uc3Qgcm93ID0gcm93c1tpXTtcbiAgICAgIGxldCBjdXJCcmFuY2ggPSB0cmVlO1xuXG4gICAgICBmb3IgKGxldCBqID0gMCwgbHAgPSBwYXRoSW5mby5sZW5ndGg7IGogPCBscDsgKytqKSB7XG4gICAgICAgIGNvbnN0IHBJbmZvID0gcGF0aEluZm9bal07XG4gICAgICAgIGNvbnN0IGlkID0gcEluZm8uaWRHZXR0ZXIocm93KTtcblxuICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocEluZm8ucmVsYXRpb24pIHtcbiAgICAgICAgICBjb25zdCBwYXJlbnRNb2RlbCA9IHN0YWNrW3BJbmZvLmVuY1BhcmVudFBhdGhdO1xuXG4gICAgICAgICAgY3VyQnJhbmNoID0gcEluZm8uZ2V0QnJhbmNoKHBhcmVudE1vZGVsKTtcblxuICAgICAgICAgIGlmICghY3VyQnJhbmNoKSB7XG4gICAgICAgICAgICBjdXJCcmFuY2ggPSBwSW5mby5jcmVhdGVCcmFuY2gocGFyZW50TW9kZWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBtb2RlbCA9IHBJbmZvLmdldE1vZGVsRnJvbUJyYW5jaChjdXJCcmFuY2gsIGlkKTtcblxuICAgICAgICBpZiAoIW1vZGVsKSB7XG4gICAgICAgICAgbW9kZWwgPSBjcmVhdGVNb2RlbChyb3csIHBJbmZvLCBrZXlJbmZvQnlQYXRoKTtcbiAgICAgICAgICBwSW5mby5zZXRNb2RlbFRvQnJhbmNoKGN1ckJyYW5jaCwgaWQsIG1vZGVsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN0YWNrW3BJbmZvLmVuY1BhdGhdID0gbW9kZWw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZmluYWxpemUocGF0aEluZm9bMF0sIF8udmFsdWVzKHRyZWUpKTtcbiAgfVxuXG4gIGNyZWF0ZUtleUluZm8ocm93cykge1xuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhyb3dzWzBdKTtcbiAgICBjb25zdCBrZXlJbmZvID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICBjb25zdCBrZXkgPSBrZXlzW2ldO1xuICAgICAgY29uc3Qgc2VwSWR4ID0ga2V5Lmxhc3RJbmRleE9mKHRoaXMuc2VwKTtcblxuICAgICAgaWYgKHNlcElkeCA9PT0gLTEpIHtcbiAgICAgICAgY29uc3QgcEluZm8gPSB0aGlzLnBhdGhJbmZvWycnXTtcbiAgICAgICAgY29uc3QgY29sID0ga2V5O1xuXG4gICAgICAgIGlmICghcEluZm8ub21pdENvbHNbY29sXSkge1xuICAgICAgICAgIGtleUluZm8ucHVzaCh7XG4gICAgICAgICAgICBwSW5mbzogcEluZm8sXG4gICAgICAgICAgICBrZXk6IGtleSxcbiAgICAgICAgICAgIGNvbDogY29sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGVuY1BhdGggPSBrZXkuc3Vic3RyKDAsIHNlcElkeCk7XG4gICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmRlY29kZShlbmNQYXRoKTtcbiAgICAgICAgY29uc3QgY29sID0ga2V5LnN1YnN0cihzZXBJZHggKyAxKTtcbiAgICAgICAgY29uc3QgcEluZm8gPSB0aGlzLnBhdGhJbmZvW3BhdGhdO1xuXG4gICAgICAgIGlmICghcEluZm8ub21pdENvbHNbY29sXSkge1xuICAgICAgICAgIGtleUluZm8ucHVzaCh7XG4gICAgICAgICAgICBwSW5mbzogcEluZm8sXG4gICAgICAgICAgICBrZXk6IGtleSxcbiAgICAgICAgICAgIGNvbDogY29sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gXy5ncm91cEJ5KGtleUluZm8sIGtJbmZvID0+IGtJbmZvLnBJbmZvLmVuY1BhdGgpO1xuICB9XG5cbiAgZmluYWxpemUocEluZm8sIG1vZGVscykge1xuICAgIGNvbnN0IHJlbE5hbWVzID0gT2JqZWN0LmtleXMocEluZm8uY2hpbGRyZW4pO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkobW9kZWxzKSkge1xuICAgICAgZm9yIChsZXQgbSA9IDAsIGxtID0gbW9kZWxzLmxlbmd0aDsgbSA8IGxtOyArK20pIHtcbiAgICAgICAgdGhpcy5maW5hbGl6ZU9uZShwSW5mbywgcmVsTmFtZXMsIG1vZGVsc1ttXSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmluYWxpemVPbmUocEluZm8sIHJlbE5hbWVzLCBtb2RlbHMpO1xuICAgIH1cblxuICAgIHJldHVybiBtb2RlbHM7XG4gIH1cblxuICBmaW5hbGl6ZU9uZShwSW5mbywgcmVsTmFtZXMsIG1vZGVsKSB7XG4gICAgZm9yIChsZXQgciA9IDAsIGxyID0gcmVsTmFtZXMubGVuZ3RoOyByIDwgbHI7ICsrcikge1xuICAgICAgY29uc3QgcmVsTmFtZSA9IHJlbE5hbWVzW3JdO1xuICAgICAgY29uc3QgYnJhbmNoID0gbW9kZWxbcmVsTmFtZV07XG4gICAgICBjb25zdCBjaGlsZFBhdGhJbmZvID0gcEluZm8uY2hpbGRyZW5bcmVsTmFtZV07XG5cbiAgICAgIGNvbnN0IGZpbmFsaXplZCA9IGNoaWxkUGF0aEluZm8uZmluYWxpemVCcmFuY2goYnJhbmNoLCBtb2RlbCk7XG4gICAgICB0aGlzLmZpbmFsaXplKGNoaWxkUGF0aEluZm8sIGZpbmFsaXplZCk7XG4gICAgfVxuICB9XG5cbiAgYnVpbGQoe2V4cHIsIGJ1aWxkZXIsIHNlbGVjdEZpbHRlciwgbW9kZWxDbGFzcywgcmVsYXRpb24sIHBhdGgsIHBhcmVudEluZm99KSB7XG4gICAgY29uc3QgaW5mbyA9IHRoaXMuY3JlYXRlUGF0aEluZm8oe1xuICAgICAgbW9kZWxDbGFzcyxcbiAgICAgIHBhdGgsXG4gICAgICByZWxhdGlvbixcbiAgICAgIHBhcmVudEluZm9cbiAgICB9KTtcblxuICAgIHRoaXMucGF0aEluZm9bcGF0aF0gPSBpbmZvO1xuXG4gICAgdGhpcy5idWlsZFNlbGVjdHMoe1xuICAgICAgYnVpbGRlcixcbiAgICAgIHNlbGVjdEZpbHRlcixcbiAgICAgIG1vZGVsQ2xhc3MsXG4gICAgICByZWxhdGlvbixcbiAgICAgIGluZm9cbiAgICB9KTtcblxuICAgIGZvckVhY2hFeHByKGV4cHIsIG1vZGVsQ2xhc3MsIChjaGlsZEV4cHIsIHJlbGF0aW9uKSA9PiB7XG4gICAgICBjb25zdCBuZXh0UGF0aCA9IHRoaXMuam9pblBhdGgocGF0aCwgcmVsYXRpb24ubmFtZSk7XG4gICAgICBjb25zdCBlbmNOZXh0UGF0aCA9IHRoaXMuZW5jb2RlKG5leHRQYXRoKTtcbiAgICAgIGNvbnN0IGVuY0pvaW5UYWJsZVBhdGggPSByZWxhdGlvbi5qb2luVGFibGVcbiAgICAgICAgPyB0aGlzLmVuY29kZShqb2luVGFibGVGb3JQYXRoKG5leHRQYXRoKSlcbiAgICAgICAgOiBudWxsO1xuXG4gICAgICBjb25zdCBmaWx0ZXJRdWVyeSA9IGNyZWF0ZUZpbHRlclF1ZXJ5KHtcbiAgICAgICAgYnVpbGRlcixcbiAgICAgICAgcmVsYXRpb24sXG4gICAgICAgIGV4cHI6IGNoaWxkRXhwclxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlbGF0ZWRKb2luU2VsZWN0UXVlcnkgPSBjcmVhdGVSZWxhdGVkSm9pbkZyb21RdWVyeSh7XG4gICAgICAgIGZpbHRlclF1ZXJ5LFxuICAgICAgICByZWxhdGlvbixcbiAgICAgICAgYWxsUmVsYXRpb25zOiB0aGlzLmFsbFJlbGF0aW9uc1xuICAgICAgfSk7XG5cbiAgICAgIHJlbGF0aW9uLmpvaW4oYnVpbGRlciwge1xuICAgICAgICBqb2luT3BlcmF0aW9uOiAnbGVmdEpvaW4nLFxuICAgICAgICBvd25lclRhYmxlOiBpbmZvLmVuY1BhdGgsXG4gICAgICAgIHJlbGF0ZWRUYWJsZUFsaWFzOiBlbmNOZXh0UGF0aCxcbiAgICAgICAgam9pblRhYmxlQWxpYXM6IGVuY0pvaW5UYWJsZVBhdGgsXG4gICAgICAgIHJlbGF0ZWRKb2luU2VsZWN0UXVlcnk6IHJlbGF0ZWRKb2luU2VsZWN0UXVlcnlcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBcHBseSByZWxhdGlvbi5tb2RpZnkgc2luY2UgaXQgbWF5IGFsc28gY29udGFpbnMgc2VsZWN0aW9ucy4gRG9uJ3QgbW92ZSB0aGlzXG4gICAgICAvLyB0byB0aGUgY3JlYXRlRmlsdGVyUXVlcnkgZnVuY3Rpb24gYmVjYXVzZSByZWxhdGVkSm9pblNlbGVjdFF1ZXJ5IGlzIGNsb25lZFxuICAgICAgLy8gRnJvbSB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoYXQgZnVuY3Rpb24gYW5kIHdlIGRvbid0IHdhbnQgcmVsYXRpb24ubW9kaWZ5XG4gICAgICAvLyB0byBiZSBjYWxsZWQgdHdpY2UgZm9yIGl0LlxuICAgICAgZmlsdGVyUXVlcnkubW9kaWZ5KHJlbGF0aW9uLm1vZGlmeSk7XG5cbiAgICAgIHRoaXMuYnVpbGQoe1xuICAgICAgICBleHByOiBjaGlsZEV4cHIsXG4gICAgICAgIGJ1aWxkZXI6IGJ1aWxkZXIsXG4gICAgICAgIG1vZGVsQ2xhc3M6IHJlbGF0aW9uLnJlbGF0ZWRNb2RlbENsYXNzLFxuICAgICAgICByZWxhdGlvbjogcmVsYXRpb24sXG4gICAgICAgIHBhcmVudEluZm86IGluZm8sXG4gICAgICAgIHBhdGg6IG5leHRQYXRoLFxuICAgICAgICBzZWxlY3RGaWx0ZXI6IChjb2wpID0+IHtcbiAgICAgICAgICByZXR1cm4gZmlsdGVyUXVlcnkuaGFzU2VsZWN0aW9uKGNvbCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgY3JlYXRlUGF0aEluZm8oe21vZGVsQ2xhc3MsIHBhdGgsIHJlbGF0aW9uLCBwYXJlbnRJbmZvfSkge1xuICAgIGNvbnN0IGVuY1BhdGggPSB0aGlzLmVuY29kZShwYXRoKTtcbiAgICBsZXQgaW5mbztcblxuICAgIGlmIChyZWxhdGlvbiAmJiByZWxhdGlvbi5pc09uZVRvT25lKCkpIHtcbiAgICAgIGluZm8gPSBuZXcgT25lVG9PbmVQYXRoSW5mbygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbmZvID0gbmV3IFBhdGhJbmZvKCk7XG4gICAgfVxuXG4gICAgaW5mby5wYXRoID0gcGF0aDtcbiAgICBpbmZvLmVuY1BhdGggPSBlbmNQYXRoO1xuICAgIGluZm8ucGFyZW50UGF0aCA9IHBhcmVudEluZm8gJiYgcGFyZW50SW5mby5wYXRoO1xuICAgIGluZm8uZW5jUGFyZW50UGF0aCA9IHBhcmVudEluZm8gJiYgcGFyZW50SW5mby5lbmNQYXRoO1xuICAgIGluZm8ubW9kZWxDbGFzcyA9IG1vZGVsQ2xhc3M7XG4gICAgaW5mby5yZWxhdGlvbiA9IHJlbGF0aW9uO1xuICAgIGluZm8uaWRHZXR0ZXIgPSB0aGlzLmNyZWF0ZUlkR2V0dGVyKG1vZGVsQ2xhc3MsIGVuY1BhdGgpO1xuXG4gICAgaWYgKHBhcmVudEluZm8pIHtcbiAgICAgIHBhcmVudEluZm8uY2hpbGRyZW5bcmVsYXRpb24ubmFtZV0gPSBpbmZvO1xuICAgIH1cblxuICAgIHJldHVybiBpbmZvO1xuICB9XG5cbiAgYnVpbGRTZWxlY3RzKHtidWlsZGVyLCBzZWxlY3RGaWx0ZXIsIG1vZGVsQ2xhc3MsIHJlbGF0aW9uLCBpbmZvfSkge1xuICAgIGNvbnN0IHNlbGVjdHMgPSBbXTtcbiAgICBjb25zdCBpZENvbHMgPSBtb2RlbENsYXNzLmdldElkQ29sdW1uQXJyYXkoKTtcbiAgICBjb25zdCByb290VGFibGUgPSB0aGlzLnJvb3RNb2RlbENsYXNzLnRhYmxlTmFtZTtcblxuICAgIGNvbHVtbkluZm9bbW9kZWxDbGFzcy50YWJsZU5hbWVdLmNvbHVtbnMuZm9yRWFjaChjb2wgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyUGFzc2VkID0gc2VsZWN0RmlsdGVyKGNvbCk7XG4gICAgICBjb25zdCBpc0lkQ29sdW1uID0gaWRDb2xzLmluZGV4T2YoY29sKSAhPT0gLTE7XG5cbiAgICAgIGlmIChmaWx0ZXJQYXNzZWQgfHwgaXNJZENvbHVtbikge1xuICAgICAgICBzZWxlY3RzLnB1c2goe1xuICAgICAgICAgIGNvbDogYCR7aW5mby5lbmNQYXRoIHx8IHJvb3RUYWJsZX0uJHtjb2x9YCxcbiAgICAgICAgICBhbGlhczogdGhpcy5qb2luUGF0aChpbmZvLmVuY1BhdGgsIGNvbClcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFmaWx0ZXJQYXNzZWQpIHtcbiAgICAgICAgICBpbmZvLm9taXRDb2xzW2NvbF0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAocmVsYXRpb24gJiYgcmVsYXRpb24uam9pblRhYmxlRXh0cmFDb2xzKSB7XG4gICAgICBjb25zdCBqb2luVGFibGUgPSB0aGlzLmVuY29kZShqb2luVGFibGVGb3JQYXRoKGluZm8ucGF0aCkpO1xuXG4gICAgICByZWxhdGlvbi5qb2luVGFibGVFeHRyYUNvbHMuZm9yRWFjaChjb2wgPT4ge1xuICAgICAgICBpZiAoc2VsZWN0RmlsdGVyKGNvbCkpIHtcbiAgICAgICAgICBzZWxlY3RzLnB1c2goe1xuICAgICAgICAgICAgY29sOiBgJHtqb2luVGFibGV9LiR7Y29sfWAsXG4gICAgICAgICAgICBhbGlhczogdGhpcy5qb2luUGF0aChpbmZvLmVuY1BhdGgsIGNvbClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9vTG9uZ0FsaWFzZXMgPSBzZWxlY3RzLmZpbHRlcihzZWxlY3QgPT4gc2VsZWN0LmFsaWFzLmxlbmd0aCA+IGlkTGVuZ3RoTGltaXQpO1xuXG4gICAgaWYgKHRvb0xvbmdBbGlhc2VzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcih7XG4gICAgICAgIGVhZ2VyOiBgaWRlbnRpZmllciAke3Rvb0xvbmdBbGlhc2VzWzBdLmFsaWFzfSBpcyBvdmVyICR7aWRMZW5ndGhMaW1pdH0gY2hhcmFjdGVycyBsb25nIGBcbiAgICAgICAgICAgICArIGBhbmQgd291bGQgYmUgdHJ1bmNhdGVkIGJ5IHRoZSBkYXRhYmFzZSBlbmdpbmUuYFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgYnVpbGRlci5zZWxlY3Qoc2VsZWN0cy5tYXAoc2VsZWN0ID0+IGAke3NlbGVjdC5jb2x9IGFzICR7c2VsZWN0LmFsaWFzfWApKTtcbiAgfVxuXG4gIGVuY29kZShwYXRoKSB7XG4gICAgaWYgKCF0aGlzLm9wdC5taW5pbWl6ZSkge1xuICAgICAgbGV0IGVuY1BhdGggPSB0aGlzLmVuY29kaW5nc1twYXRoXTtcblxuICAgICAgaWYgKCFlbmNQYXRoKSB7XG4gICAgICAgIGNvbnN0IHBhcnRzID0gcGF0aC5zcGxpdCh0aGlzLnNlcCk7XG5cbiAgICAgICAgLy8gRG9uJ3QgZW5jb2RlIHRoZSByb290LlxuICAgICAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgICBlbmNQYXRoID0gcGF0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbmNQYXRoID0gcGFydHMubWFwKHBhcnQgPT4gdGhpcy5vcHQuYWxpYXNlc1twYXJ0XSB8fCBwYXJ0KS5qb2luKHRoaXMuc2VwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZW5jb2RpbmdzW3BhdGhdID0gZW5jUGF0aDtcbiAgICAgICAgdGhpcy5kZWNvZGluZ3NbZW5jUGF0aF0gPSBwYXRoO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZW5jUGF0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGVuY1BhdGggPSB0aGlzLmVuY29kaW5nc1twYXRoXTtcblxuICAgICAgaWYgKCFlbmNQYXRoKSB7XG4gICAgICAgIC8vIERvbid0IGVuY29kZSB0aGUgcm9vdC5cbiAgICAgICAgaWYgKCFwYXRoKSB7XG4gICAgICAgICAgZW5jUGF0aCA9IHBhdGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZW5jUGF0aCA9IHRoaXMubmV4dEVuY29kZWRQYXRoKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVuY29kaW5nc1twYXRoXSA9IGVuY1BhdGg7XG4gICAgICAgIHRoaXMuZGVjb2RpbmdzW2VuY1BhdGhdID0gcGF0aDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGVuY1BhdGg7XG4gICAgfVxuICB9XG5cbiAgZGVjb2RlKHBhdGgpIHtcbiAgICByZXR1cm4gdGhpcy5kZWNvZGluZ3NbcGF0aF07XG4gIH1cblxuICBuZXh0RW5jb2RlZFBhdGgoKSB7XG4gICAgcmV0dXJuIGBfdCR7Kyt0aGlzLmVuY0lkeH1gO1xuICB9XG5cbiAgY3JlYXRlSWRHZXR0ZXIobW9kZWxDbGFzcywgcGF0aCkge1xuICAgIGNvbnN0IGlkQ29scyA9IG1vZGVsQ2xhc3MuZ2V0SWRDb2x1bW5BcnJheSgpLm1hcChjb2wgPT4gdGhpcy5qb2luUGF0aChwYXRoLCBjb2wpKTtcblxuICAgIGlmIChpZENvbHMubGVuZ3RoID09PSAxKSB7XG4gICAgICByZXR1cm4gY3JlYXRlU2luZ2xlSWRHZXR0ZXIoaWRDb2xzKTtcbiAgICB9IGVsc2UgaWYgKGlkQ29scy5sZW5ndGggPT09IDIpIHtcbiAgICAgIHJldHVybiBjcmVhdGVUd29JZEdldHRlcihpZENvbHMpO1xuICAgIH0gZWxzZSBpZiAoaWRDb2xzLmxlbmd0aCA9PT0gMykge1xuICAgICAgcmV0dXJuIGNyZWF0ZVRocmVlSWRHZXR0ZXIoaWRDb2xzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGNyZWF0ZU5JZEdldHRlcihpZENvbHMpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBzZXAoKSB7XG4gICAgcmV0dXJuIHRoaXMub3B0LnNlcGFyYXRvcjtcbiAgfVxuXG4gIGpvaW5QYXRoKHBhdGgsIG5leHRQYXJ0KSB7XG4gICAgaWYgKHBhdGgpIHtcbiAgICAgIHJldHVybiBgJHtwYXRofSR7dGhpcy5zZXB9JHtuZXh0UGFydH1gO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbmV4dFBhcnQ7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGZpbmRBbGxNb2RlbHMoZXhwciwgbW9kZWxDbGFzcykge1xuICBjb25zdCBtb2RlbHMgPSBbXTtcblxuICBmaW5kQWxsTW9kZWxzSW1wbChleHByLCBtb2RlbENsYXNzLCBtb2RlbHMpO1xuXG4gIHJldHVybiBfLnVuaXFCeShtb2RlbHMsICd0YWJsZU5hbWUnKTtcbn1cblxuZnVuY3Rpb24gZmluZEFsbE1vZGVsc0ltcGwoZXhwciwgbW9kZWxDbGFzcywgbW9kZWxzKSB7XG4gIG1vZGVscy5wdXNoKG1vZGVsQ2xhc3MpO1xuXG4gIGZvckVhY2hFeHByKGV4cHIsIG1vZGVsQ2xhc3MsIChjaGlsZEV4cHIsIHJlbGF0aW9uKSA9PiB7XG4gICAgZmluZEFsbE1vZGVsc0ltcGwoY2hpbGRFeHByLCByZWxhdGlvbi5yZWxhdGVkTW9kZWxDbGFzcywgbW9kZWxzKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGZpbmRBbGxSZWxhdGlvbnMoZXhwciwgbW9kZWxDbGFzcykge1xuICBjb25zdCByZWxhdGlvbnMgPSBbXTtcblxuICBmaW5kQWxsUmVsYXRpb25zSW1wbChleHByLCBtb2RlbENsYXNzLCByZWxhdGlvbnMpO1xuXG4gIHJldHVybiBfLnVuaXFXaXRoKHJlbGF0aW9ucywgKGxocywgcmhzKSA9PiBsaHMgPT09IHJocyk7XG59XG5cbmZ1bmN0aW9uIGZpbmRBbGxSZWxhdGlvbnNJbXBsKGV4cHIsIG1vZGVsQ2xhc3MsIHJlbGF0aW9ucykge1xuICBmb3JFYWNoRXhwcihleHByLCBtb2RlbENsYXNzLCAoY2hpbGRFeHByLCByZWxhdGlvbikgPT4ge1xuICAgIHJlbGF0aW9ucy5wdXNoKHJlbGF0aW9uKTtcblxuICAgIGZpbmRBbGxSZWxhdGlvbnNJbXBsKGNoaWxkRXhwciwgcmVsYXRpb24ucmVsYXRlZE1vZGVsQ2xhc3MsIHJlbGF0aW9ucyk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBmZXRjaENvbHVtbkluZm8oYnVpbGRlciwgbW9kZWxzKSB7XG4gIGNvbnN0IGtuZXggPSBidWlsZGVyLmtuZXgoKTtcblxuICByZXR1cm4gUHJvbWlzZS5hbGwobW9kZWxzLm1hcChNb2RlbENsYXNzID0+IHtcbiAgICBjb25zdCB0YWJsZSA9IE1vZGVsQ2xhc3MudGFibGVOYW1lO1xuXG4gICAgaWYgKGNvbHVtbkluZm9bdGFibGVdKSB7XG4gICAgICByZXR1cm4gY29sdW1uSW5mb1t0YWJsZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbHVtbkluZm9bdGFibGVdID0ga25leCh0YWJsZSkuY29sdW1uSW5mbygpLnRoZW4oaW5mbyA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgICBjb2x1bW5zOiBPYmplY3Qua2V5cyhpbmZvKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbHVtbkluZm9bdGFibGVdID0gcmVzdWx0O1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBjb2x1bW5JbmZvW3RhYmxlXTtcbiAgICB9XG4gIH0pKTtcbn1cblxuZnVuY3Rpb24gZm9yRWFjaEV4cHIoZXhwciwgbW9kZWxDbGFzcywgY2FsbGJhY2spIHtcbiAgY29uc3QgcmVsYXRpb25zID0gbW9kZWxDbGFzcy5nZXRSZWxhdGlvbnMoKTtcbiAgY29uc3QgcmVsTmFtZXMgPSBPYmplY3Qua2V5cyhyZWxhdGlvbnMpO1xuXG4gIGlmIChleHByLmlzQWxsUmVjdXJzaXZlKCkgfHwgZXhwci5tYXhSZWN1cnNpb25EZXB0aCgpID4gcmVsYXRpb25SZWN1cnNpb25MaW1pdCkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3Ioe1xuICAgICAgZWFnZXI6IGByZWN1cnNpb24gZGVwdGggb2YgZWFnZXIgZXhwcmVzc2lvbiAke2V4cHIudG9TdHJpbmcoKX0gdG9vIGJpZyBmb3IgSm9pbkVhZ2VyQWxnb3JpdGhtYFxuICAgIH0pO1xuICB9XG5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSByZWxOYW1lcy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICBjb25zdCByZWxOYW1lID0gcmVsTmFtZXNbaV07XG4gICAgY29uc3QgcmVsYXRpb24gPSByZWxhdGlvbnNbcmVsTmFtZV07XG4gICAgY29uc3QgY2hpbGRFeHByID0gZXhwci5jaGlsZEV4cHJlc3Npb24ocmVsYXRpb24ubmFtZSk7XG5cbiAgICBpZiAoY2hpbGRFeHByKSB7XG4gICAgICBjYWxsYmFjayhjaGlsZEV4cHIsIHJlbGF0aW9uLCByZWxOYW1lKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlU2luZ2xlSWRHZXR0ZXIoaWRDb2xzKSB7XG4gIGNvbnN0IGlkQ29sID0gaWRDb2xzWzBdO1xuXG4gIHJldHVybiAocm93KSA9PiB7XG4gICAgY29uc3QgdmFsID0gcm93W2lkQ29sXTtcblxuICAgIGlmICghdmFsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVR3b0lkR2V0dGVyKGlkQ29scykge1xuICBjb25zdCBpZENvbDEgPSBpZENvbHNbMF07XG4gIGNvbnN0IGlkQ29sMiA9IGlkQ29sc1sxXTtcblxuICByZXR1cm4gKHJvdykgPT4ge1xuICAgIGNvbnN0IHZhbDEgPSByb3dbaWRDb2wxXTtcbiAgICBjb25zdCB2YWwyID0gcm93W2lkQ29sMl07XG5cbiAgICBpZiAoIXZhbDEgfHwgIXZhbDIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYCR7dmFsMX0sJHt2YWwyfWA7XG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUaHJlZUlkR2V0dGVyKGlkQ29scykge1xuICBjb25zdCBpZENvbDEgPSBpZENvbHNbMF07XG4gIGNvbnN0IGlkQ29sMiA9IGlkQ29sc1sxXTtcbiAgY29uc3QgaWRDb2wzID0gaWRDb2xzWzJdO1xuXG4gIHJldHVybiAocm93KSA9PiB7XG4gICAgY29uc3QgdmFsMSA9IHJvd1tpZENvbDFdO1xuICAgIGNvbnN0IHZhbDIgPSByb3dbaWRDb2wyXTtcbiAgICBjb25zdCB2YWwzID0gcm93W2lkQ29sM107XG5cbiAgICBpZiAoIXZhbDEgfHwgIXZhbDIgfHwgIXZhbDMpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYCR7dmFsMX0sJHt2YWwyfSwke3ZhbDN9YDtcbiAgICB9XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZU5JZEdldHRlcihpZENvbHMpIHtcbiAgcmV0dXJuIChyb3cpID0+IHtcbiAgICBsZXQgaWQgPSAnJztcblxuICAgIGZvciAobGV0IGkgPSAwLCBsID0gaWRDb2xzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgY29uc3QgdmFsID0gcm93W2lkQ29sc1tpXV07XG5cbiAgICAgIGlmICghdmFsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICBpZCArPSAoaSA+IDAgPyAnLCcgOiAnJykgKyB2YWw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGlkO1xuICB9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVGaWx0ZXJRdWVyeSh7YnVpbGRlciwgZXhwciwgcmVsYXRpb259KSB7XG4gIGNvbnN0IGZpbHRlclF1ZXJ5ID0gcmVsYXRpb24ucmVsYXRlZE1vZGVsQ2xhc3NcbiAgICAucXVlcnkoKVxuICAgIC5jaGlsZFF1ZXJ5T2YoYnVpbGRlcik7XG5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSBleHByLmFyZ3MubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgY29uc3QgZmlsdGVyTmFtZSA9IGV4cHIuYXJnc1tpXTtcbiAgICBjb25zdCBmaWx0ZXIgPSBleHByLmZpbHRlcnNbZmlsdGVyTmFtZV07XG5cbiAgICBpZiAodHlwZW9mIGZpbHRlciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcih7ZWFnZXI6IGBjb3VsZCBub3QgZmluZCBmaWx0ZXIgXCIke2ZpbHRlck5hbWV9XCIgZm9yIHJlbGF0aW9uIFwiJHtyZWxhdGlvbi5uYW1lfVwiYH0pO1xuICAgIH1cblxuICAgIGZpbHRlcihmaWx0ZXJRdWVyeSk7XG4gIH1cblxuICByZXR1cm4gZmlsdGVyUXVlcnk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVJlbGF0ZWRKb2luRnJvbVF1ZXJ5KHtmaWx0ZXJRdWVyeSwgcmVsYXRpb24sIGFsbFJlbGF0aW9uc30pIHtcbiAgY29uc3QgcmVsYXRlZEpvaW5Gcm9tUXVlcnkgPSBmaWx0ZXJRdWVyeS5jbG9uZSgpO1xuXG4gIGNvbnN0IGFsbEZvcmVpZ25LZXlzID0gZmluZEFsbEZvcmVpZ25LZXlzRm9yTW9kZWwoe1xuICAgIG1vZGVsQ2xhc3M6IHJlbGF0aW9uLnJlbGF0ZWRNb2RlbENsYXNzLFxuICAgIGFsbFJlbGF0aW9uc1xuICB9KTtcblxuICByZXR1cm4gcmVsYXRlZEpvaW5Gcm9tUXVlcnkuc2VsZWN0KGFsbEZvcmVpZ25LZXlzLmZpbHRlcihjb2wgPT4ge1xuICAgIHJldHVybiAhcmVsYXRlZEpvaW5Gcm9tUXVlcnkuaGFzU2VsZWN0aW9uKGNvbCk7XG4gIH0pKTtcbn1cblxuZnVuY3Rpb24gZmluZEFsbEZvcmVpZ25LZXlzRm9yTW9kZWwoe21vZGVsQ2xhc3MsIGFsbFJlbGF0aW9uc30pIHtcbiAgbGV0IGZvcmVpZ25LZXlzID0gbW9kZWxDbGFzcy5nZXRJZENvbHVtbkFycmF5KCkuc2xpY2UoKTtcblxuICBhbGxSZWxhdGlvbnMuZm9yRWFjaChyZWwgPT4ge1xuICAgIGlmIChyZWwucmVsYXRlZE1vZGVsQ2xhc3MudGFibGVOYW1lID09PSBtb2RlbENsYXNzLnRhYmxlTmFtZSkge1xuICAgICAgcmVsLnJlbGF0ZWRDb2wuZm9yRWFjaChjb2wgPT4gZm9yZWlnbktleXMucHVzaChjb2wpKTtcbiAgICB9XG5cbiAgICBpZiAocmVsLm93bmVyTW9kZWxDbGFzcy50YWJsZU5hbWUgPT09IG1vZGVsQ2xhc3MudGFibGVOYW1lKSB7XG4gICAgICByZWwub3duZXJDb2wuZm9yRWFjaChjb2wgPT4gZm9yZWlnbktleXMucHVzaChjb2wpKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBfLnVuaXEoZm9yZWlnbktleXMpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVNb2RlbChyb3csIHBJbmZvLCBrZXlJbmZvQnlQYXRoKSB7XG4gIGNvbnN0IGtleUluZm8gPSBrZXlJbmZvQnlQYXRoW3BJbmZvLmVuY1BhdGhdO1xuICBjb25zdCBqc29uID0ge307XG5cbiAgZm9yIChsZXQgayA9IDAsIGxrID0ga2V5SW5mby5sZW5ndGg7IGsgPCBsazsgKytrKSB7XG4gICAgY29uc3Qga0luZm8gPSBrZXlJbmZvW2tdO1xuICAgIGpzb25ba0luZm8uY29sXSA9IHJvd1trSW5mby5rZXldO1xuICB9XG5cbiAgcmV0dXJuIHBJbmZvLm1vZGVsQ2xhc3MuZnJvbURhdGFiYXNlSnNvbihqc29uKTtcbn1cblxuZnVuY3Rpb24gam9pblRhYmxlRm9yUGF0aChwYXRoKSB7XG4gIHJldHVybiBwYXRoICsgJ19qb2luJztcbn1cblxuY2xhc3MgUGF0aEluZm8ge1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMucGF0aCA9IG51bGw7XG4gICAgdGhpcy5lbmNQYXRoID0gbnVsbDtcbiAgICB0aGlzLmVuY1BhcmVudFBhdGggPSBudWxsO1xuICAgIHRoaXMubW9kZWxDbGFzcyA9IG51bGw7XG4gICAgdGhpcy5yZWxhdGlvbiA9IG51bGw7XG4gICAgdGhpcy5vbWl0Q29scyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy5jaGlsZHJlbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy5pZEdldHRlciA9IG51bGw7XG4gIH1cblxuICBjcmVhdGVCcmFuY2gocGFyZW50TW9kZWwpIHtcbiAgICBjb25zdCBicmFuY2ggPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIHBhcmVudE1vZGVsW3RoaXMucmVsYXRpb24ubmFtZV0gPSBicmFuY2g7XG4gICAgcmV0dXJuIGJyYW5jaDtcbiAgfVxuXG4gIGdldEJyYW5jaChwYXJlbnRNb2RlbCkge1xuICAgIHJldHVybiBwYXJlbnRNb2RlbFt0aGlzLnJlbGF0aW9uLm5hbWVdO1xuICB9XG5cbiAgZ2V0TW9kZWxGcm9tQnJhbmNoKGJyYW5jaCwgaWQpIHtcbiAgICByZXR1cm4gYnJhbmNoW2lkXTtcbiAgfVxuXG4gIHNldE1vZGVsVG9CcmFuY2goYnJhbmNoLCBpZCwgbW9kZWwpIHtcbiAgICBicmFuY2hbaWRdID0gbW9kZWw7XG4gIH1cblxuICBmaW5hbGl6ZUJyYW5jaChicmFuY2gsIHBhcmVudE1vZGVsKSB7XG4gICAgY29uc3QgcmVsTW9kZWxzID0gXy52YWx1ZXMoYnJhbmNoKTtcbiAgICBwYXJlbnRNb2RlbFt0aGlzLnJlbGF0aW9uLm5hbWVdID0gcmVsTW9kZWxzO1xuICAgIHJldHVybiByZWxNb2RlbHM7XG4gIH1cbn1cblxuY2xhc3MgT25lVG9PbmVQYXRoSW5mbyBleHRlbmRzIFBhdGhJbmZvIHtcblxuICBjcmVhdGVCcmFuY2gocGFyZW50TW9kZWwpIHtcbiAgICByZXR1cm4gcGFyZW50TW9kZWw7XG4gIH1cblxuICBnZXRCcmFuY2gocGFyZW50TW9kZWwpIHtcbiAgICByZXR1cm4gcGFyZW50TW9kZWw7XG4gIH1cblxuICBnZXRNb2RlbEZyb21CcmFuY2goYnJhbmNoLCBpZCkge1xuICAgIHJldHVybiBicmFuY2hbdGhpcy5yZWxhdGlvbi5uYW1lXTtcbiAgfVxuXG4gIHNldE1vZGVsVG9CcmFuY2goYnJhbmNoLCBpZCwgbW9kZWwpIHtcbiAgICBicmFuY2hbdGhpcy5yZWxhdGlvbi5uYW1lXSA9IG1vZGVsO1xuICB9XG5cblxuICBmaW5hbGl6ZUJyYW5jaChicmFuY2gsIHBhcmVudE1vZGVsKSB7XG4gICAgcGFyZW50TW9kZWxbdGhpcy5yZWxhdGlvbi5uYW1lXSA9IGJyYW5jaCB8fCBudWxsO1xuICAgIHJldHVybiBicmFuY2ggfHwgbnVsbDtcbiAgfVxufVxuIl19