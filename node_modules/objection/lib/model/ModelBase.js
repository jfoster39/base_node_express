'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _keys2 = require('babel-runtime/core-js/object/keys');

var _keys3 = _interopRequireDefault(_keys2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _create = require('babel-runtime/core-js/object/create');

var _create2 = _interopRequireDefault(_create);

var _dec, _dec2, _dec3, _desc, _value, _class, _class2, _temp;

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _ajv = require('ajv');

var _ajv2 = _interopRequireDefault(_ajv);

var _hiddenData = require('../utils/decorators/hiddenData');

var _hiddenData2 = _interopRequireDefault(_hiddenData);

var _ValidationError = require('../ValidationError');

var _ValidationError2 = _interopRequireDefault(_ValidationError);

var _splitQueryProps = require('../utils/splitQueryProps');

var _splitQueryProps2 = _interopRequireDefault(_splitQueryProps);

var _classUtils = require('../utils/classUtils');

var _memoize = require('../utils/decorators/memoize');

var _memoize2 = _interopRequireDefault(_memoize);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var ajv = new _ajv2.default({ allErrors: true, validateSchema: false, ownProperties: true });
var ajvCache = (0, _create2.default)(null);

/**
 * @typedef {Object} ModelOptions
 *
 * @property {boolean} [patch]
 * @property {boolean} [skipValidation]
 * @property {Model} [old]
 */

var ModelBase = (_dec = (0, _hiddenData2.default)({ name: 'omitFromJson', append: true }), _dec2 = (0, _hiddenData2.default)({ name: 'omitFromDatabaseJson', append: true }), _dec3 = (0, _hiddenData2.default)('stashedQueryProps'), (_class = (_temp = _class2 = function () {
  function ModelBase() {
    (0, _classCallCheck3.default)(this, ModelBase);
  }

  /**
   * @param {Object} jsonSchema
   * @param {Object} json
   * @param {ModelOptions=} options
   * @return {Object}
   */


  /**
   * @type {Object}
   */
  ModelBase.prototype.$beforeValidate = function $beforeValidate(jsonSchema, json, options) {
    /* istanbul ignore next */
    return jsonSchema;
  };

  /**
   * @param {Object=} json
   * @param {ModelOptions=} options
   * @throws {ValidationError}
   * @return {Object}
   */


  /**
   * @type {Array.<string>}
   */


  ModelBase.prototype.$validate = function $validate() {
    var json = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this;
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    var jsonSchema = this.constructor.getJsonSchema();

    if (!jsonSchema || options.skipValidation) {
      return json;
    }

    // No need to call $beforeValidate (and clone the jsonSchema) if $beforeValidate has not been overwritten.
    if (this.$beforeValidate !== ModelBase.prototype.$beforeValidate) {
      jsonSchema = _lodash2.default.cloneDeep(jsonSchema);
      jsonSchema = this.$beforeValidate(jsonSchema, json, options);
    }

    var validator = this.constructor.getJsonSchemaValidator(jsonSchema, options.patch);
    validator(json);

    if (validator.errors) {
      throw parseValidationError(validator.errors);
    }

    this.$afterValidate(json, options);
    return json;
  };

  /**
   * @param {Object=} json
   * @param {ModelOptions=} options
   */


  ModelBase.prototype.$afterValidate = function $afterValidate(json, options) {}
  // Do nothing by default.


  /**
   * @param {Object} json
   * @return {Object}
   */
  ;

  ModelBase.prototype.$parseDatabaseJson = function $parseDatabaseJson(json) {
    return json;
  };

  /**
   * @param {Object} json
   * @return {Object}
   */


  ModelBase.prototype.$formatDatabaseJson = function $formatDatabaseJson(json) {
    return json;
  };

  /**
   * @param {Object} json
   * @param {ModelOptions=} options
   * @return {Object}
   */


  ModelBase.prototype.$parseJson = function $parseJson(json, options) {
    return json;
  };

  /**
   * @param {Object} json
   * @return {Object}
   */


  ModelBase.prototype.$formatJson = function $formatJson(json) {
    return json;
  };

  /**
   * @return {Object}
   */


  ModelBase.prototype.$toDatabaseJson = function $toDatabaseJson() {
    return this.$$toJson(true, null, null);
  };

  /**
   * @return {Object}
   */


  ModelBase.prototype.$toJson = function $toJson() {
    return this.$$toJson(false, null, null);
  };

  ModelBase.prototype.toJSON = function toJSON() {
    return this.$toJson();
  };

  /**
   * @param {Object} json
   * @param {ModelOptions=} options
   * @returns {ModelBase}
   * @throws ValidationError
   */


  ModelBase.prototype.$setJson = function $setJson(json) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    json = json || {};

    if (!_lodash2.default.isObject(json) || _lodash2.default.isString(json) || _lodash2.default.isNumber(json) || _lodash2.default.isDate(json) || _lodash2.default.isArray(json) || _lodash2.default.isFunction(json) || _lodash2.default.isTypedArray(json) || _lodash2.default.isRegExp(json)) {

      throw new Error('You should only pass objects to $setJson method. ' + '$setJson method was given an invalid value ' + json);
    }

    if (!options.patch) {
      json = mergeWithDefaults(this.constructor.getJsonSchema(), json);
    }

    // If the json contains query properties like, knex Raw queries or knex/objection query
    // builders, we need to split those off into a separate object. This object will be
    // joined back in the $toDatabaseJson method.
    var split = (0, _splitQueryProps2.default)(this.constructor, json);

    if (split.query) {
      // Stash the query properties for later use in $toDatabaseJson method.
      this.$stashedQueryProps(split.query);
    }

    split.json = this.$parseJson(split.json, options);
    split.json = this.$validate(split.json, options);

    return this.$set(split.json);
  };

  /**
   * @param {Object} json
   * @returns {ModelBase}
   */


  ModelBase.prototype.$setDatabaseJson = function $setDatabaseJson(json) {
    json = this.$parseDatabaseJson(json);

    if (json) {
      var keys = (0, _keys3.default)(json);

      for (var i = 0, l = keys.length; i < l; ++i) {
        var key = keys[i];
        this[key] = json[key];
      }
    }

    return this;
  };

  /**
   * @param {Object} obj
   * @returns {ModelBase}
   */


  ModelBase.prototype.$set = function $set(obj) {
    if (obj) {
      var keys = (0, _keys3.default)(obj);

      for (var i = 0, l = keys.length; i < l; ++i) {
        var key = keys[i];
        var value = obj[key];

        if (key.charAt(0) !== '$' && typeof value !== 'function') {
          this[key] = value;
        }
      }
    }

    return this;
  };

  /**
   * @param {Array.<string>=} keys
   * @returns {Array.<string>}
   */


  ModelBase.prototype.$omitFromJson = function $omitFromJson(keys) {};

  /**
   * @param {Array.<string>=} keys
   * @returns {Array.<string>}
   */


  ModelBase.prototype.$omitFromDatabaseJson = function $omitFromDatabaseJson(keys) {};

  /**
   * @param {Object=} queryProps
   * @returns {Object}
   */


  ModelBase.prototype.$stashedQueryProps = function $stashedQueryProps(queryProps) {};

  /**
   * @param {string|Array.<string>|Object.<string, boolean>} keys
   * @returns {ModelBase}
   */


  ModelBase.prototype.$omit = function $omit() {
    if (arguments.length === 1 && _lodash2.default.isObject(arguments[0])) {
      var keys = arguments[0];

      if (Array.isArray(keys)) {
        omitArray(this, keys);
      } else {
        omitObject(this, keys);
      }
    } else {
      omitArray(this, _lodash2.default.toArray(arguments));
    }

    return this;
  };

  /**
   * @param {string|Array.<string>|Object.<string, boolean>} keys
   * @returns {ModelBase} `this` for chaining.
   */


  ModelBase.prototype.$pick = function $pick() {
    if (arguments.length === 1 && _lodash2.default.isObject(arguments[0])) {
      var keys = arguments[0];

      if (Array.isArray(keys)) {
        pickArray(this, keys);
      } else {
        pickObject(this, keys);
      }
    } else {
      pickArray(this, _lodash2.default.toArray(arguments));
    }

    return this;
  };

  /**
   * @param {Array.<string>} props
   * @return {Array.<*>}
   */


  ModelBase.prototype.$values = function $values() {
    if (arguments.length === 0) {
      return _lodash2.default.values(this);
    } else {
      var args = arguments.length === 1 && Array.isArray(arguments[0]) ? arguments[0] : arguments;

      switch (args.length) {
        case 1:
          return [this[args[0]]];
        case 2:
          return [this[args[0]], this[args[1]]];
        case 3:
          return [this[args[0]], this[args[1]], this[args[2]]];
        default:
          {
            var ret = new Array(args.length);

            for (var i = 0, l = args.length; i < l; ++i) {
              ret[i] = this[args[i]];
            }

            return ret;
          }
      }
    }
  };

  /**
   * @param {Array.<string>} props
   * @return {string}
   */


  ModelBase.prototype.$propKey = function $propKey(props) {
    switch (props.length) {
      case 1:
        return this[props[0]] + '';
      case 2:
        return this[props[0]] + ',' + this[props[1]];
      case 3:
        return this[props[0]] + ',' + this[props[1]] + ',' + this[props[2]];
      default:
        {
          var key = '';

          for (var i = 0, l = props.length; i < l; ++i) {
            key += this[props[i]] + (i < props.length - 1 ? ',' : '');
          }

          return key;
        }
    }
  };

  /**
   * @return {ModelBase}
   */


  ModelBase.prototype.$clone = function $clone() {
    var clone = new this.constructor();
    var keys = (0, _keys3.default)(this);

    for (var i = 0, l = keys.length; i < l; ++i) {
      var key = keys[i];
      var value = this[key];

      if (_lodash2.default.isObject(value)) {
        clone[key] = cloneObject(value);
      } else {
        clone[key] = value;
      }
    }

    if (this.$omitFromDatabaseJson()) {
      clone.$omitFromDatabaseJson(this.$omitFromDatabaseJson());
    }

    if (this.$omitFromJson()) {
      clone.$omitFromJson(this.$omitFromJson());
    }

    if (this.$stashedQueryProps()) {
      clone.$stashedQueryProps(this.$stashedQueryProps());
    }

    return clone;
  };

  /**
   * @protected
   */


  ModelBase.prototype.$$toJson = function $$toJson(createDbJson, omit, pick) {
    var json = toJsonImpl(this, createDbJson, omit, pick);

    if (createDbJson) {
      return this.$formatDatabaseJson(json);
    } else {
      return this.$formatJson(json);
    }
  };

  /**
   * @param {function=} subclassConstructor
   * @return {Constructor.<ModelBase>}
   */


  ModelBase.extend = function extend(subclassConstructor) {
    if (_lodash2.default.isEmpty(subclassConstructor.name)) {
      throw new Error('Each ModelBase subclass constructor must have a name');
    }

    (0, _classUtils.inherits)(subclassConstructor, this);
    return subclassConstructor;
  };

  /**
   * @param {Object=} json
   * @param {ModelOptions=} options
   * @returns {Model}
   * @throws ValidationError
   */


  ModelBase.fromJson = function fromJson(json, options) {
    var model = new this();
    model.$setJson(json || {}, options);
    return model;
  };

  /**
   * @param {Object=} json
   * @returns {Model}
   */


  ModelBase.fromDatabaseJson = function fromDatabaseJson(json) {
    var model = new this();
    model.$setDatabaseJson(json || {});
    return model;
  };

  /**
   * @param {Object} obj
   * @param {string} prop
   */


  ModelBase.omitImpl = function omitImpl(obj, prop) {
    delete obj[prop];
  };

  /**
   * @param {Object} jsonSchema
   * @param {boolean} skipRequired
   * @returns {function}
   */


  ModelBase.getJsonSchemaValidator = function getJsonSchemaValidator(jsonSchema, skipRequired) {
    skipRequired = !!skipRequired;

    if (jsonSchema === this.getJsonSchema()) {
      // Fast path for the common case: the json schema is never modified.
      return this.getDefaultJsonSchemaValidator(skipRequired);
    } else {
      var key = (0, _stringify2.default)(jsonSchema);
      var validators = ajvCache[key];

      if (!validators) {
        validators = {};
        ajvCache[key] = validators;
      }

      var validator = validators[skipRequired];
      if (!validator) {
        validator = compileJsonSchemaValidator(jsonSchema, skipRequired);
        validators[skipRequired] = validator;
      }

      return validator;
    }
  };

  ModelBase.getJsonSchema = function getJsonSchema() {
    // Memoized getter in case jsonSchema is a getter property (usually is with ES6).
    return this.jsonSchema;
  };

  /**
   * @returns {function}
   */


  ModelBase.getDefaultJsonSchemaValidator = function getDefaultJsonSchemaValidator(skipRequired) {
    return compileJsonSchemaValidator(this.getJsonSchema(), skipRequired);
  };

  /**
   * @param {string} columnName
   * @returns {string}
   */


  ModelBase.columnNameToPropertyName = function columnNameToPropertyName(columnName) {
    var model = new this();
    var addedProps = _lodash2.default.keys(model.$parseDatabaseJson({}));

    var row = {};
    row[columnName] = null;

    var props = _lodash2.default.keys(model.$parseDatabaseJson(row));
    var propertyName = _lodash2.default.first(_lodash2.default.difference(props, addedProps));

    return propertyName || null;
  };

  /**
   * @param {string} propertyName
   * @returns {string}
   */


  ModelBase.propertyNameToColumnName = function propertyNameToColumnName(propertyName) {
    var model = new this();
    var addedCols = _lodash2.default.keys(model.$formatDatabaseJson({}));

    var obj = {};
    obj[propertyName] = null;

    var cols = _lodash2.default.keys(model.$formatDatabaseJson(obj));
    var columnName = _lodash2.default.first(_lodash2.default.difference(cols, addedCols));

    return columnName || null;
  };

  return ModelBase;
}(), _class2.jsonSchema = null, _class2.virtualAttributes = null, _temp), (_applyDecoratedDescriptor(_class.prototype, '$omitFromJson', [_dec], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '$omitFromJson'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '$omitFromDatabaseJson', [_dec2], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '$omitFromDatabaseJson'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '$stashedQueryProps', [_dec3], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '$stashedQueryProps'), _class.prototype), _applyDecoratedDescriptor(_class, 'getJsonSchema', [_memoize2.default], (0, _getOwnPropertyDescriptor2.default)(_class, 'getJsonSchema'), _class), _applyDecoratedDescriptor(_class, 'getDefaultJsonSchemaValidator', [_memoize2.default], (0, _getOwnPropertyDescriptor2.default)(_class, 'getDefaultJsonSchemaValidator'), _class), _applyDecoratedDescriptor(_class, 'columnNameToPropertyName', [_memoize2.default], (0, _getOwnPropertyDescriptor2.default)(_class, 'columnNameToPropertyName'), _class), _applyDecoratedDescriptor(_class, 'propertyNameToColumnName', [_memoize2.default], (0, _getOwnPropertyDescriptor2.default)(_class, 'propertyNameToColumnName'), _class)), _class));
exports.default = ModelBase;


function mergeWithDefaults(jsonSchema, json) {
  var merged = null;

  if (!jsonSchema) {
    return json;
  }

  if (!jsonSchema.properties) {
    return json;
  }

  var propNames = (0, _keys3.default)(jsonSchema.properties);
  // Check each schema property for default value.
  for (var i = 0, l = propNames.length; i < l; ++i) {
    var propName = propNames[i];
    var prop = jsonSchema.properties[propName];

    if (!_lodash2.default.has(json, propName) && _lodash2.default.has(prop, 'default')) {
      if (merged === null) {
        // Only take expensive clone if needed.
        merged = _lodash2.default.cloneDeep(json);
      }

      if (_lodash2.default.isObject(prop.default)) {
        merged[propName] = _lodash2.default.cloneDeep(prop.default);
      } else {
        merged[propName] = prop.default;
      }
    }
  }

  if (merged === null) {
    return json;
  } else {
    return merged;
  }
}

function parseValidationError(errors) {
  var errorHash = {};
  var index = 0;

  for (var i = 0; i < errors.length; ++i) {
    var error = errors[i];
    var key = error.dataPath.substring(1);

    if (!key) {
      var match = /should have required property '(.+)'/.exec(error.message);
      if (match && match.length > 1) {
        key = match[1];
      }
    }

    if (!key && error.params && error.params.additionalProperty) {
      key = error.params.additionalProperty;
    }

    if (!key) {
      key = (index++).toString();
    }

    errorHash[key] = error.message;
  }

  return new _ValidationError2.default(errorHash);
}

function toJsonImpl(model, createDbJson, omit, pick) {
  if (createDbJson) {
    return toDatabaseJsonImpl(model, omit, pick);
  } else {
    return toExternalJsonImpl(model, omit, pick);
  }
}

function toDatabaseJsonImpl(model, omit, pick) {
  var json = {};
  var omitFromJson = model.$omitFromDatabaseJson();
  var stash = model.$stashedQueryProps();

  if (stash) {
    var _keys = (0, _keys3.default)(stash);

    for (var i = 0, l = _keys.length; i < l; ++i) {
      var key = _keys[i];
      json[key] = stash[key];
    }
  }

  var keys = (0, _keys3.default)(model);

  for (var _i = 0, _l = keys.length; _i < _l; ++_i) {
    var _key = keys[_i];
    assignJsonValue(json, _key, model[_key], omit, pick, omitFromJson, true);
  }

  return json;
}

function toExternalJsonImpl(model, omit, pick) {
  var json = {};
  var omitFromJson = model.$omitFromJson();
  var keys = (0, _keys3.default)(model);

  for (var i = 0, l = keys.length; i < l; ++i) {
    var key = keys[i];
    assignJsonValue(json, key, model[key], omit, pick, omitFromJson, false);
  }

  if (model.constructor.virtualAttributes) {
    var vAttr = model.constructor.virtualAttributes;

    for (var _i2 = 0, _l2 = vAttr.length; _i2 < _l2; ++_i2) {
      var _key2 = vAttr[_i2];
      var value = model[_key2];

      if (_lodash2.default.isFunction(value)) {
        value = value.call(model);
      }

      assignJsonValue(json, _key2, value, omit, pick, omitFromJson, false);
    }
  }

  return json;
}

function assignJsonValue(json, key, value, omit, pick, omitFromJson, createDbJson) {
  if (key.charAt(0) !== '$' && !_lodash2.default.isFunction(value) && !_lodash2.default.isUndefined(value) && (!omit || !omit[key]) && (!pick || pick[key]) && (!omitFromJson || !contains(omitFromJson, key))) {

    if (value !== null && (typeof value === 'undefined' ? 'undefined' : (0, _typeof3.default)(value)) === 'object') {
      json[key] = toJsonObject(value, createDbJson);
    } else {
      json[key] = value;
    }
  }
}

function toJsonObject(value, createDbJson) {
  if (Array.isArray(value)) {
    return toJsonArray(value, createDbJson);
  } else if (value instanceof ModelBase) {
    if (createDbJson) {
      return value.$toDatabaseJson();
    } else {
      return value.$toJson();
    }
  } else if (Buffer.isBuffer(value)) {
    return value;
  } else {
    return _lodash2.default.cloneDeep(value);
  }
}

function toJsonArray(value, createDbJson) {
  var ret = new Array(value.length);

  for (var i = 0, l = ret.length; i < l; ++i) {
    ret[i] = toJsonObject(value[i], createDbJson);
  }

  return ret;
}

function cloneObject(value) {
  if (Array.isArray(value)) {
    return cloneArray(value);
  } else if (value instanceof ModelBase) {
    return value.$clone();
  } else if (Buffer.isBuffer(value)) {
    return new Buffer(value);
  } else {
    return _lodash2.default.cloneDeep(value);
  }
}

function cloneArray(value) {
  var ret = new Array(value.length);

  for (var i = 0, l = ret.length; i < l; ++i) {
    ret[i] = cloneObject(value[i]);
  }

  return ret;
}

function omitObject(model, keyObj) {
  var ModelClass = model.constructor;
  var keys = (0, _keys3.default)(keyObj);

  for (var i = 0, l = keys.length; i < l; ++i) {
    var key = keys[i];
    var value = keyObj[key];

    if (value && key.charAt(0) !== '$' && _lodash2.default.has(model, key)) {
      ModelClass.omitImpl(model, key);
    }
  }
}

function omitArray(model, keys) {
  var ModelClass = model.constructor;

  for (var i = 0, l = keys.length; i < l; ++i) {
    var key = keys[i];

    if (key.charAt(0) !== '$' && _lodash2.default.has(model, key)) {
      ModelClass.omitImpl(model, key);
    }
  }
}

function pickObject(model, keyObj) {
  var ModelClass = model.constructor;
  var keys = (0, _keys3.default)(model);

  for (var i = 0, l = keys.length; i < l; ++i) {
    var key = keys[i];

    if (key.charAt(0) !== '$' && !keyObj[key]) {
      ModelClass.omitImpl(model, key);
    }
  }
}

function pickArray(model, pick) {
  var ModelClass = model.constructor;
  var keys = (0, _keys3.default)(model);

  for (var i = 0, l = keys.length; i < l; ++i) {
    var key = keys[i];

    if (key.charAt(0) !== '$' && !contains(pick, key)) {
      ModelClass.omitImpl(model, key);
    }
  }
}

function contains(arr, value) {
  for (var i = 0, l = arr.length; i < l; ++i) {
    if (arr[i] === value) {
      return true;
    }
  }
  return false;
}

function compileJsonSchemaValidator(jsonSchema, skipRequired) {
  var origRequired = void 0;

  try {
    if (skipRequired) {
      origRequired = jsonSchema.required;
      jsonSchema.required = [];
    }

    return ajv.compile(jsonSchema);
  } finally {
    if (skipRequired) {
      jsonSchema.required = origRequired;
    }
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1vZGVsQmFzZS5qcyJdLCJuYW1lcyI6WyJhanYiLCJhbGxFcnJvcnMiLCJ2YWxpZGF0ZVNjaGVtYSIsIm93blByb3BlcnRpZXMiLCJhanZDYWNoZSIsIk1vZGVsQmFzZSIsIm5hbWUiLCJhcHBlbmQiLCIkYmVmb3JlVmFsaWRhdGUiLCJqc29uU2NoZW1hIiwianNvbiIsIm9wdGlvbnMiLCIkdmFsaWRhdGUiLCJjb25zdHJ1Y3RvciIsImdldEpzb25TY2hlbWEiLCJza2lwVmFsaWRhdGlvbiIsInByb3RvdHlwZSIsImNsb25lRGVlcCIsInZhbGlkYXRvciIsImdldEpzb25TY2hlbWFWYWxpZGF0b3IiLCJwYXRjaCIsImVycm9ycyIsInBhcnNlVmFsaWRhdGlvbkVycm9yIiwiJGFmdGVyVmFsaWRhdGUiLCIkcGFyc2VEYXRhYmFzZUpzb24iLCIkZm9ybWF0RGF0YWJhc2VKc29uIiwiJHBhcnNlSnNvbiIsIiRmb3JtYXRKc29uIiwiJHRvRGF0YWJhc2VKc29uIiwiJCR0b0pzb24iLCIkdG9Kc29uIiwidG9KU09OIiwiJHNldEpzb24iLCJpc09iamVjdCIsImlzU3RyaW5nIiwiaXNOdW1iZXIiLCJpc0RhdGUiLCJpc0FycmF5IiwiaXNGdW5jdGlvbiIsImlzVHlwZWRBcnJheSIsImlzUmVnRXhwIiwiRXJyb3IiLCJtZXJnZVdpdGhEZWZhdWx0cyIsInNwbGl0IiwicXVlcnkiLCIkc3Rhc2hlZFF1ZXJ5UHJvcHMiLCIkc2V0IiwiJHNldERhdGFiYXNlSnNvbiIsImtleXMiLCJpIiwibCIsImxlbmd0aCIsImtleSIsIm9iaiIsInZhbHVlIiwiY2hhckF0IiwiJG9taXRGcm9tSnNvbiIsIiRvbWl0RnJvbURhdGFiYXNlSnNvbiIsInF1ZXJ5UHJvcHMiLCIkb21pdCIsImFyZ3VtZW50cyIsIkFycmF5Iiwib21pdEFycmF5Iiwib21pdE9iamVjdCIsInRvQXJyYXkiLCIkcGljayIsInBpY2tBcnJheSIsInBpY2tPYmplY3QiLCIkdmFsdWVzIiwidmFsdWVzIiwiYXJncyIsInJldCIsIiRwcm9wS2V5IiwicHJvcHMiLCIkY2xvbmUiLCJjbG9uZSIsImNsb25lT2JqZWN0IiwiY3JlYXRlRGJKc29uIiwib21pdCIsInBpY2siLCJ0b0pzb25JbXBsIiwiZXh0ZW5kIiwic3ViY2xhc3NDb25zdHJ1Y3RvciIsImlzRW1wdHkiLCJmcm9tSnNvbiIsIm1vZGVsIiwiZnJvbURhdGFiYXNlSnNvbiIsIm9taXRJbXBsIiwicHJvcCIsInNraXBSZXF1aXJlZCIsImdldERlZmF1bHRKc29uU2NoZW1hVmFsaWRhdG9yIiwidmFsaWRhdG9ycyIsImNvbXBpbGVKc29uU2NoZW1hVmFsaWRhdG9yIiwiY29sdW1uTmFtZVRvUHJvcGVydHlOYW1lIiwiY29sdW1uTmFtZSIsImFkZGVkUHJvcHMiLCJyb3ciLCJwcm9wZXJ0eU5hbWUiLCJmaXJzdCIsImRpZmZlcmVuY2UiLCJwcm9wZXJ0eU5hbWVUb0NvbHVtbk5hbWUiLCJhZGRlZENvbHMiLCJjb2xzIiwidmlydHVhbEF0dHJpYnV0ZXMiLCJtZXJnZWQiLCJwcm9wZXJ0aWVzIiwicHJvcE5hbWVzIiwicHJvcE5hbWUiLCJoYXMiLCJkZWZhdWx0IiwiZXJyb3JIYXNoIiwiaW5kZXgiLCJlcnJvciIsImRhdGFQYXRoIiwic3Vic3RyaW5nIiwibWF0Y2giLCJleGVjIiwibWVzc2FnZSIsInBhcmFtcyIsImFkZGl0aW9uYWxQcm9wZXJ0eSIsInRvU3RyaW5nIiwidG9EYXRhYmFzZUpzb25JbXBsIiwidG9FeHRlcm5hbEpzb25JbXBsIiwib21pdEZyb21Kc29uIiwic3Rhc2giLCJhc3NpZ25Kc29uVmFsdWUiLCJ2QXR0ciIsImNhbGwiLCJpc1VuZGVmaW5lZCIsImNvbnRhaW5zIiwidG9Kc29uT2JqZWN0IiwidG9Kc29uQXJyYXkiLCJCdWZmZXIiLCJpc0J1ZmZlciIsImNsb25lQXJyYXkiLCJrZXlPYmoiLCJNb2RlbENsYXNzIiwiYXJyIiwib3JpZ1JlcXVpcmVkIiwicmVxdWlyZWQiLCJjb21waWxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7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RUQsQ0FBMUMsRUFBNkM7QUFDM0MsUUFBTUcsTUFBTUosS0FBS0MsQ0FBTCxDQUFaOztBQUVBLFFBQUlHLElBQUlHLE1BQUosQ0FBVyxDQUFYLE1BQWtCLEdBQWxCLElBQXlCLENBQUMwRSxTQUFTbEQsSUFBVCxFQUFlM0IsR0FBZixDQUE5QixFQUFtRDtBQUNqRG9GLGlCQUFXakQsUUFBWCxDQUFvQkYsS0FBcEIsRUFBMkJqQyxHQUEzQjtBQUNEO0FBQ0Y7QUFDRjs7QUFFRCxTQUFTNkUsUUFBVCxDQUFrQlEsR0FBbEIsRUFBdUJuRixLQUF2QixFQUE4QjtBQUM1QixPQUFLLElBQUlMLElBQUksQ0FBUixFQUFXQyxJQUFJdUYsSUFBSXRGLE1BQXhCLEVBQWdDRixJQUFJQyxDQUFwQyxFQUF1QyxFQUFFRCxDQUF6QyxFQUE0QztBQUMxQyxRQUFJd0YsSUFBSXhGLENBQUosTUFBV0ssS0FBZixFQUFzQjtBQUNwQixhQUFPLElBQVA7QUFDRDtBQUNGO0FBQ0QsU0FBTyxLQUFQO0FBQ0Q7O0FBRUQsU0FBU3NDLDBCQUFULENBQW9DbkYsVUFBcEMsRUFBZ0RnRixZQUFoRCxFQUE4RDtBQUM1RCxNQUFJaUQscUJBQUo7O0FBRUEsTUFBSTtBQUNGLFFBQUlqRCxZQUFKLEVBQWtCO0FBQ2hCaUQscUJBQWVqSSxXQUFXa0ksUUFBMUI7QUFDQWxJLGlCQUFXa0ksUUFBWCxHQUFzQixFQUF0QjtBQUNEOztBQUVELFdBQU8zSSxJQUFJNEksT0FBSixDQUFZbkksVUFBWixDQUFQO0FBQ0QsR0FQRCxTQU9VO0FBQ1IsUUFBSWdGLFlBQUosRUFBa0I7QUFDaEJoRixpQkFBV2tJLFFBQVgsR0FBc0JELFlBQXRCO0FBQ0Q7QUFDRjtBQUNGIiwiZmlsZSI6Ik1vZGVsQmFzZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQWp2IGZyb20gJ2Fqdic7XG5pbXBvcnQgaGlkZGVuRGF0YSBmcm9tICcuLi91dGlscy9kZWNvcmF0b3JzL2hpZGRlbkRhdGEnO1xuaW1wb3J0IFZhbGlkYXRpb25FcnJvciBmcm9tICcuLi9WYWxpZGF0aW9uRXJyb3InO1xuaW1wb3J0IHNwbGl0UXVlcnlQcm9wcyBmcm9tICcuLi91dGlscy9zcGxpdFF1ZXJ5UHJvcHMnO1xuaW1wb3J0IHtpbmhlcml0c30gZnJvbSAnLi4vdXRpbHMvY2xhc3NVdGlscyc7XG5pbXBvcnQgbWVtb2l6ZSBmcm9tICcuLi91dGlscy9kZWNvcmF0b3JzL21lbW9pemUnO1xuXG5jb25zdCBhanYgPSBuZXcgQWp2KHthbGxFcnJvcnM6IHRydWUsIHZhbGlkYXRlU2NoZW1hOiBmYWxzZSwgb3duUHJvcGVydGllczogdHJ1ZX0pO1xuY29uc3QgYWp2Q2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IE1vZGVsT3B0aW9uc1xuICpcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3BhdGNoXVxuICogQHByb3BlcnR5IHtib29sZWFufSBbc2tpcFZhbGlkYXRpb25dXG4gKiBAcHJvcGVydHkge01vZGVsfSBbb2xkXVxuICovXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGVsQmFzZSB7XG5cbiAgLyoqXG4gICAqIEB0eXBlIHtPYmplY3R9XG4gICAqL1xuICBzdGF0aWMganNvblNjaGVtYSA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEB0eXBlIHtBcnJheS48c3RyaW5nPn1cbiAgICovXG4gIHN0YXRpYyB2aXJ0dWFsQXR0cmlidXRlcyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBqc29uU2NoZW1hXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBqc29uXG4gICAqIEBwYXJhbSB7TW9kZWxPcHRpb25zPX0gb3B0aW9uc1xuICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAqL1xuICAkYmVmb3JlVmFsaWRhdGUoanNvblNjaGVtYSwganNvbiwgb3B0aW9ucykge1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgcmV0dXJuIGpzb25TY2hlbWE7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtPYmplY3Q9fSBqc29uXG4gICAqIEBwYXJhbSB7TW9kZWxPcHRpb25zPX0gb3B0aW9uc1xuICAgKiBAdGhyb3dzIHtWYWxpZGF0aW9uRXJyb3J9XG4gICAqIEByZXR1cm4ge09iamVjdH1cbiAgICovXG4gICR2YWxpZGF0ZShqc29uID0gdGhpcywgb3B0aW9ucyA9IHt9KSB7XG4gICAgbGV0IGpzb25TY2hlbWEgPSB0aGlzLmNvbnN0cnVjdG9yLmdldEpzb25TY2hlbWEoKTtcblxuICAgIGlmICghanNvblNjaGVtYSB8fCBvcHRpb25zLnNraXBWYWxpZGF0aW9uKSB7XG4gICAgICByZXR1cm4ganNvbjtcbiAgICB9XG5cbiAgICAvLyBObyBuZWVkIHRvIGNhbGwgJGJlZm9yZVZhbGlkYXRlIChhbmQgY2xvbmUgdGhlIGpzb25TY2hlbWEpIGlmICRiZWZvcmVWYWxpZGF0ZSBoYXMgbm90IGJlZW4gb3ZlcndyaXR0ZW4uXG4gICAgaWYgKHRoaXMuJGJlZm9yZVZhbGlkYXRlICE9PSBNb2RlbEJhc2UucHJvdG90eXBlLiRiZWZvcmVWYWxpZGF0ZSkge1xuICAgICAganNvblNjaGVtYSA9IF8uY2xvbmVEZWVwKGpzb25TY2hlbWEpO1xuICAgICAganNvblNjaGVtYSA9IHRoaXMuJGJlZm9yZVZhbGlkYXRlKGpzb25TY2hlbWEsIGpzb24sIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIGNvbnN0IHZhbGlkYXRvciA9IHRoaXMuY29uc3RydWN0b3IuZ2V0SnNvblNjaGVtYVZhbGlkYXRvcihqc29uU2NoZW1hLCBvcHRpb25zLnBhdGNoKTtcbiAgICB2YWxpZGF0b3IoanNvbik7XG5cbiAgICBpZiAodmFsaWRhdG9yLmVycm9ycykge1xuICAgICAgdGhyb3cgcGFyc2VWYWxpZGF0aW9uRXJyb3IodmFsaWRhdG9yLmVycm9ycyk7XG4gICAgfVxuXG4gICAgdGhpcy4kYWZ0ZXJWYWxpZGF0ZShqc29uLCBvcHRpb25zKTtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge09iamVjdD19IGpzb25cbiAgICogQHBhcmFtIHtNb2RlbE9wdGlvbnM9fSBvcHRpb25zXG4gICAqL1xuICAkYWZ0ZXJWYWxpZGF0ZShqc29uLCBvcHRpb25zKSB7XG4gICAgLy8gRG8gbm90aGluZyBieSBkZWZhdWx0LlxuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBqc29uXG4gICAqIEByZXR1cm4ge09iamVjdH1cbiAgICovXG4gICRwYXJzZURhdGFiYXNlSnNvbihqc29uKSB7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtPYmplY3R9IGpzb25cbiAgICogQHJldHVybiB7T2JqZWN0fVxuICAgKi9cbiAgJGZvcm1hdERhdGFiYXNlSnNvbihqc29uKSB7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtPYmplY3R9IGpzb25cbiAgICogQHBhcmFtIHtNb2RlbE9wdGlvbnM9fSBvcHRpb25zXG4gICAqIEByZXR1cm4ge09iamVjdH1cbiAgICovXG4gICRwYXJzZUpzb24oanNvbiwgb3B0aW9ucykge1xuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBqc29uXG4gICAqIEByZXR1cm4ge09iamVjdH1cbiAgICovXG4gICRmb3JtYXRKc29uKGpzb24pIHtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAqL1xuICAkdG9EYXRhYmFzZUpzb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuJCR0b0pzb24odHJ1ZSwgbnVsbCwgbnVsbCk7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7T2JqZWN0fVxuICAgKi9cbiAgJHRvSnNvbigpIHtcbiAgICByZXR1cm4gdGhpcy4kJHRvSnNvbihmYWxzZSwgbnVsbCwgbnVsbCk7XG4gIH1cblxuICB0b0pTT04oKSB7XG4gICAgcmV0dXJuIHRoaXMuJHRvSnNvbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBqc29uXG4gICAqIEBwYXJhbSB7TW9kZWxPcHRpb25zPX0gb3B0aW9uc1xuICAgKiBAcmV0dXJucyB7TW9kZWxCYXNlfVxuICAgKiBAdGhyb3dzIFZhbGlkYXRpb25FcnJvclxuICAgKi9cbiAgJHNldEpzb24oanNvbiwgb3B0aW9ucyA9IHt9KSB7XG4gICAganNvbiA9IGpzb24gfHwge307XG5cbiAgICBpZiAoIV8uaXNPYmplY3QoanNvbilcbiAgICAgIHx8IF8uaXNTdHJpbmcoanNvbilcbiAgICAgIHx8IF8uaXNOdW1iZXIoanNvbilcbiAgICAgIHx8IF8uaXNEYXRlKGpzb24pXG4gICAgICB8fCBfLmlzQXJyYXkoanNvbilcbiAgICAgIHx8IF8uaXNGdW5jdGlvbihqc29uKVxuICAgICAgfHwgXy5pc1R5cGVkQXJyYXkoanNvbilcbiAgICAgIHx8IF8uaXNSZWdFeHAoanNvbikpIHtcblxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3Ugc2hvdWxkIG9ubHkgcGFzcyBvYmplY3RzIHRvICRzZXRKc29uIG1ldGhvZC4gJ1xuICAgICAgICArICckc2V0SnNvbiBtZXRob2Qgd2FzIGdpdmVuIGFuIGludmFsaWQgdmFsdWUgJ1xuICAgICAgICArIGpzb24pO1xuICAgIH1cblxuICAgIGlmICghb3B0aW9ucy5wYXRjaCkge1xuICAgICAganNvbiA9IG1lcmdlV2l0aERlZmF1bHRzKHRoaXMuY29uc3RydWN0b3IuZ2V0SnNvblNjaGVtYSgpLCBqc29uKTtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGUganNvbiBjb250YWlucyBxdWVyeSBwcm9wZXJ0aWVzIGxpa2UsIGtuZXggUmF3IHF1ZXJpZXMgb3Iga25leC9vYmplY3Rpb24gcXVlcnlcbiAgICAvLyBidWlsZGVycywgd2UgbmVlZCB0byBzcGxpdCB0aG9zZSBvZmYgaW50byBhIHNlcGFyYXRlIG9iamVjdC4gVGhpcyBvYmplY3Qgd2lsbCBiZVxuICAgIC8vIGpvaW5lZCBiYWNrIGluIHRoZSAkdG9EYXRhYmFzZUpzb24gbWV0aG9kLlxuICAgIGNvbnN0IHNwbGl0ID0gc3BsaXRRdWVyeVByb3BzKHRoaXMuY29uc3RydWN0b3IsIGpzb24pO1xuXG4gICAgaWYgKHNwbGl0LnF1ZXJ5KSB7XG4gICAgICAvLyBTdGFzaCB0aGUgcXVlcnkgcHJvcGVydGllcyBmb3IgbGF0ZXIgdXNlIGluICR0b0RhdGFiYXNlSnNvbiBtZXRob2QuXG4gICAgICB0aGlzLiRzdGFzaGVkUXVlcnlQcm9wcyhzcGxpdC5xdWVyeSk7XG4gICAgfVxuXG4gICAgc3BsaXQuanNvbiA9IHRoaXMuJHBhcnNlSnNvbihzcGxpdC5qc29uLCBvcHRpb25zKTtcbiAgICBzcGxpdC5qc29uID0gdGhpcy4kdmFsaWRhdGUoc3BsaXQuanNvbiwgb3B0aW9ucyk7XG5cbiAgICByZXR1cm4gdGhpcy4kc2V0KHNwbGl0Lmpzb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBqc29uXG4gICAqIEByZXR1cm5zIHtNb2RlbEJhc2V9XG4gICAqL1xuICAkc2V0RGF0YWJhc2VKc29uKGpzb24pIHtcbiAgICBqc29uID0gdGhpcy4kcGFyc2VEYXRhYmFzZUpzb24oanNvbik7XG5cbiAgICBpZiAoanNvbikge1xuICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGpzb24pO1xuXG4gICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgICAgIHRoaXNba2V5XSA9IGpzb25ba2V5XTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqXG4gICAqIEByZXR1cm5zIHtNb2RlbEJhc2V9XG4gICAqL1xuICAkc2V0KG9iaikge1xuICAgIGlmIChvYmopIHtcbiAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvYmopO1xuXG4gICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgICAgIGNvbnN0IHZhbHVlID0gb2JqW2tleV07XG5cbiAgICAgICAgaWYgKGtleS5jaGFyQXQoMCkgIT09ICckJyAmJiB0eXBlb2YgdmFsdWUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7QXJyYXkuPHN0cmluZz49fSBrZXlzXG4gICAqIEByZXR1cm5zIHtBcnJheS48c3RyaW5nPn1cbiAgICovXG4gIEBoaWRkZW5EYXRhKHtuYW1lOiAnb21pdEZyb21Kc29uJywgYXBwZW5kOiB0cnVlfSlcbiAgJG9taXRGcm9tSnNvbihrZXlzKSB7fVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge0FycmF5LjxzdHJpbmc+PX0ga2V5c1xuICAgKiBAcmV0dXJucyB7QXJyYXkuPHN0cmluZz59XG4gICAqL1xuICBAaGlkZGVuRGF0YSh7bmFtZTogJ29taXRGcm9tRGF0YWJhc2VKc29uJywgYXBwZW5kOiB0cnVlfSlcbiAgJG9taXRGcm9tRGF0YWJhc2VKc29uKGtleXMpIHt9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7T2JqZWN0PX0gcXVlcnlQcm9wc1xuICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgKi9cbiAgQGhpZGRlbkRhdGEoJ3N0YXNoZWRRdWVyeVByb3BzJylcbiAgJHN0YXNoZWRRdWVyeVByb3BzKHF1ZXJ5UHJvcHMpIHt9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfEFycmF5LjxzdHJpbmc+fE9iamVjdC48c3RyaW5nLCBib29sZWFuPn0ga2V5c1xuICAgKiBAcmV0dXJucyB7TW9kZWxCYXNlfVxuICAgKi9cbiAgJG9taXQoKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgXy5pc09iamVjdChhcmd1bWVudHNbMF0pKSB7XG4gICAgICBsZXQga2V5cyA9IGFyZ3VtZW50c1swXTtcblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoa2V5cykpIHtcbiAgICAgICAgb21pdEFycmF5KHRoaXMsIGtleXMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb21pdE9iamVjdCh0aGlzLCBrZXlzKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgb21pdEFycmF5KHRoaXMsIF8udG9BcnJheShhcmd1bWVudHMpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge3N0cmluZ3xBcnJheS48c3RyaW5nPnxPYmplY3QuPHN0cmluZywgYm9vbGVhbj59IGtleXNcbiAgICogQHJldHVybnMge01vZGVsQmFzZX0gYHRoaXNgIGZvciBjaGFpbmluZy5cbiAgICovXG4gICRwaWNrKCkge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIF8uaXNPYmplY3QoYXJndW1lbnRzWzBdKSkge1xuICAgICAgbGV0IGtleXMgPSBhcmd1bWVudHNbMF07XG5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGtleXMpKSB7XG4gICAgICAgIHBpY2tBcnJheSh0aGlzLCBrZXlzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBpY2tPYmplY3QodGhpcywga2V5cyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHBpY2tBcnJheSh0aGlzLCBfLnRvQXJyYXkoYXJndW1lbnRzKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtBcnJheS48c3RyaW5nPn0gcHJvcHNcbiAgICogQHJldHVybiB7QXJyYXkuPCo+fVxuICAgKi9cbiAgJHZhbHVlcygpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIF8udmFsdWVzKHRoaXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBhcmdzID0gKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKVxuICAgICAgICA/IGFyZ3VtZW50c1swXVxuICAgICAgICA6IGFyZ3VtZW50cztcblxuICAgICAgc3dpdGNoIChhcmdzLmxlbmd0aCkge1xuICAgICAgICBjYXNlIDE6IHJldHVybiBbdGhpc1thcmdzWzBdXV07XG4gICAgICAgIGNhc2UgMjogcmV0dXJuIFt0aGlzW2FyZ3NbMF1dLCB0aGlzW2FyZ3NbMV1dXTtcbiAgICAgICAgY2FzZSAzOiByZXR1cm4gW3RoaXNbYXJnc1swXV0sIHRoaXNbYXJnc1sxXV0sIHRoaXNbYXJnc1syXV1dO1xuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgY29uc3QgcmV0ID0gbmV3IEFycmF5KGFyZ3MubGVuZ3RoKTtcblxuICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYXJncy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgICAgICAgIHJldFtpXSA9IHRoaXNbYXJnc1tpXV07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge0FycmF5LjxzdHJpbmc+fSBwcm9wc1xuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqL1xuICAkcHJvcEtleShwcm9wcykge1xuICAgIHN3aXRjaCAocHJvcHMubGVuZ3RoKSB7XG4gICAgICBjYXNlIDE6IHJldHVybiB0aGlzW3Byb3BzWzBdXSArICcnO1xuICAgICAgY2FzZSAyOiByZXR1cm4gdGhpc1twcm9wc1swXV0gKyAnLCcgKyB0aGlzW3Byb3BzWzFdXTtcbiAgICAgIGNhc2UgMzogcmV0dXJuIHRoaXNbcHJvcHNbMF1dICsgJywnICsgdGhpc1twcm9wc1sxXV0gKyAnLCcgKyB0aGlzW3Byb3BzWzJdXTtcbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgbGV0IGtleSA9ICcnO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcHJvcHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICAgICAga2V5ICs9IHRoaXNbcHJvcHNbaV1dICsgKChpIDwgcHJvcHMubGVuZ3RoIC0gMSkgPyAnLCcgOiAnJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ga2V5O1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHtNb2RlbEJhc2V9XG4gICAqL1xuICAkY2xvbmUoKSB7XG4gICAgY29uc3QgY2xvbmUgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpO1xuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh0aGlzKTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBsID0ga2V5cy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXNba2V5XTtcblxuICAgICAgaWYgKF8uaXNPYmplY3QodmFsdWUpKSB7XG4gICAgICAgIGNsb25lW2tleV0gPSBjbG9uZU9iamVjdCh2YWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjbG9uZVtrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuJG9taXRGcm9tRGF0YWJhc2VKc29uKCkpIHtcbiAgICAgIGNsb25lLiRvbWl0RnJvbURhdGFiYXNlSnNvbih0aGlzLiRvbWl0RnJvbURhdGFiYXNlSnNvbigpKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy4kb21pdEZyb21Kc29uKCkpIHtcbiAgICAgIGNsb25lLiRvbWl0RnJvbUpzb24odGhpcy4kb21pdEZyb21Kc29uKCkpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLiRzdGFzaGVkUXVlcnlQcm9wcygpKSB7XG4gICAgICBjbG9uZS4kc3Rhc2hlZFF1ZXJ5UHJvcHModGhpcy4kc3Rhc2hlZFF1ZXJ5UHJvcHMoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNsb25lO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gICQkdG9Kc29uKGNyZWF0ZURiSnNvbiwgb21pdCwgcGljaykge1xuICAgIGxldCBqc29uID0gdG9Kc29uSW1wbCh0aGlzLCBjcmVhdGVEYkpzb24sIG9taXQsIHBpY2spO1xuXG4gICAgaWYgKGNyZWF0ZURiSnNvbikge1xuICAgICAgcmV0dXJuIHRoaXMuJGZvcm1hdERhdGFiYXNlSnNvbihqc29uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuJGZvcm1hdEpzb24oanNvbik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb249fSBzdWJjbGFzc0NvbnN0cnVjdG9yXG4gICAqIEByZXR1cm4ge0NvbnN0cnVjdG9yLjxNb2RlbEJhc2U+fVxuICAgKi9cbiAgc3RhdGljIGV4dGVuZChzdWJjbGFzc0NvbnN0cnVjdG9yKSB7XG4gICAgaWYgKF8uaXNFbXB0eShzdWJjbGFzc0NvbnN0cnVjdG9yLm5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VhY2ggTW9kZWxCYXNlIHN1YmNsYXNzIGNvbnN0cnVjdG9yIG11c3QgaGF2ZSBhIG5hbWUnKTtcbiAgICB9XG5cbiAgICBpbmhlcml0cyhzdWJjbGFzc0NvbnN0cnVjdG9yLCB0aGlzKTtcbiAgICByZXR1cm4gc3ViY2xhc3NDb25zdHJ1Y3RvcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge09iamVjdD19IGpzb25cbiAgICogQHBhcmFtIHtNb2RlbE9wdGlvbnM9fSBvcHRpb25zXG4gICAqIEByZXR1cm5zIHtNb2RlbH1cbiAgICogQHRocm93cyBWYWxpZGF0aW9uRXJyb3JcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uLCBvcHRpb25zKSB7XG4gICAgbGV0IG1vZGVsID0gbmV3IHRoaXMoKTtcbiAgICBtb2RlbC4kc2V0SnNvbihqc29uIHx8IHt9LCBvcHRpb25zKTtcbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtPYmplY3Q9fSBqc29uXG4gICAqIEByZXR1cm5zIHtNb2RlbH1cbiAgICovXG4gIHN0YXRpYyBmcm9tRGF0YWJhc2VKc29uKGpzb24pIHtcbiAgICBsZXQgbW9kZWwgPSBuZXcgdGhpcygpO1xuICAgIG1vZGVsLiRzZXREYXRhYmFzZUpzb24oanNvbiB8fCB7fSk7XG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHByb3BcbiAgICovXG4gIHN0YXRpYyBvbWl0SW1wbChvYmosIHByb3ApIHtcbiAgICBkZWxldGUgb2JqW3Byb3BdO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBqc29uU2NoZW1hXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2tpcFJlcXVpcmVkXG4gICAqIEByZXR1cm5zIHtmdW5jdGlvbn1cbiAgICovXG4gIHN0YXRpYyBnZXRKc29uU2NoZW1hVmFsaWRhdG9yKGpzb25TY2hlbWEsIHNraXBSZXF1aXJlZCkge1xuICAgIHNraXBSZXF1aXJlZCA9ICEhc2tpcFJlcXVpcmVkO1xuXG4gICAgaWYgKGpzb25TY2hlbWEgPT09IHRoaXMuZ2V0SnNvblNjaGVtYSgpKSB7XG4gICAgICAvLyBGYXN0IHBhdGggZm9yIHRoZSBjb21tb24gY2FzZTogdGhlIGpzb24gc2NoZW1hIGlzIG5ldmVyIG1vZGlmaWVkLlxuICAgICAgcmV0dXJuIHRoaXMuZ2V0RGVmYXVsdEpzb25TY2hlbWFWYWxpZGF0b3Ioc2tpcFJlcXVpcmVkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGtleSA9IEpTT04uc3RyaW5naWZ5KGpzb25TY2hlbWEpO1xuICAgICAgbGV0IHZhbGlkYXRvcnMgPSBhanZDYWNoZVtrZXldO1xuXG4gICAgICBpZiAoIXZhbGlkYXRvcnMpIHtcbiAgICAgICAgdmFsaWRhdG9ycyA9IHt9O1xuICAgICAgICBhanZDYWNoZVtrZXldID0gdmFsaWRhdG9ycztcbiAgICAgIH1cblxuICAgICAgbGV0IHZhbGlkYXRvciA9IHZhbGlkYXRvcnNbc2tpcFJlcXVpcmVkXTtcbiAgICAgIGlmICghdmFsaWRhdG9yKSB7XG4gICAgICAgIHZhbGlkYXRvciA9IGNvbXBpbGVKc29uU2NoZW1hVmFsaWRhdG9yKGpzb25TY2hlbWEsIHNraXBSZXF1aXJlZCk7XG4gICAgICAgIHZhbGlkYXRvcnNbc2tpcFJlcXVpcmVkXSA9IHZhbGlkYXRvcjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZhbGlkYXRvcjtcbiAgICB9XG4gIH1cblxuICBAbWVtb2l6ZVxuICBzdGF0aWMgZ2V0SnNvblNjaGVtYSgpIHtcbiAgICAvLyBNZW1vaXplZCBnZXR0ZXIgaW4gY2FzZSBqc29uU2NoZW1hIGlzIGEgZ2V0dGVyIHByb3BlcnR5ICh1c3VhbGx5IGlzIHdpdGggRVM2KS5cbiAgICByZXR1cm4gdGhpcy5qc29uU2NoZW1hO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm5zIHtmdW5jdGlvbn1cbiAgICovXG4gIEBtZW1vaXplXG4gIHN0YXRpYyBnZXREZWZhdWx0SnNvblNjaGVtYVZhbGlkYXRvcihza2lwUmVxdWlyZWQpIHtcbiAgICByZXR1cm4gY29tcGlsZUpzb25TY2hlbWFWYWxpZGF0b3IodGhpcy5nZXRKc29uU2NoZW1hKCksIHNraXBSZXF1aXJlZCk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbHVtbk5hbWVcbiAgICogQHJldHVybnMge3N0cmluZ31cbiAgICovXG4gIEBtZW1vaXplXG4gIHN0YXRpYyBjb2x1bW5OYW1lVG9Qcm9wZXJ0eU5hbWUoY29sdW1uTmFtZSkge1xuICAgIGxldCBtb2RlbCA9IG5ldyB0aGlzKCk7XG4gICAgbGV0IGFkZGVkUHJvcHMgPSBfLmtleXMobW9kZWwuJHBhcnNlRGF0YWJhc2VKc29uKHt9KSk7XG5cbiAgICBsZXQgcm93ID0ge307XG4gICAgcm93W2NvbHVtbk5hbWVdID0gbnVsbDtcblxuICAgIGxldCBwcm9wcyA9IF8ua2V5cyhtb2RlbC4kcGFyc2VEYXRhYmFzZUpzb24ocm93KSk7XG4gICAgbGV0IHByb3BlcnR5TmFtZSA9IF8uZmlyc3QoXy5kaWZmZXJlbmNlKHByb3BzLCBhZGRlZFByb3BzKSk7XG5cbiAgICByZXR1cm4gcHJvcGVydHlOYW1lIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtzdHJpbmd9IHByb3BlcnR5TmFtZVxuICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgKi9cbiAgQG1lbW9pemVcbiAgc3RhdGljIHByb3BlcnR5TmFtZVRvQ29sdW1uTmFtZShwcm9wZXJ0eU5hbWUpIHtcbiAgICBsZXQgbW9kZWwgPSBuZXcgdGhpcygpO1xuICAgIGxldCBhZGRlZENvbHMgPSBfLmtleXMobW9kZWwuJGZvcm1hdERhdGFiYXNlSnNvbih7fSkpO1xuXG4gICAgbGV0IG9iaiA9IHt9O1xuICAgIG9ialtwcm9wZXJ0eU5hbWVdID0gbnVsbDtcblxuICAgIGxldCBjb2xzID0gXy5rZXlzKG1vZGVsLiRmb3JtYXREYXRhYmFzZUpzb24ob2JqKSk7XG4gICAgbGV0IGNvbHVtbk5hbWUgPSBfLmZpcnN0KF8uZGlmZmVyZW5jZShjb2xzLCBhZGRlZENvbHMpKTtcblxuICAgIHJldHVybiBjb2x1bW5OYW1lIHx8IG51bGw7XG4gIH1cbn1cblxuZnVuY3Rpb24gbWVyZ2VXaXRoRGVmYXVsdHMoanNvblNjaGVtYSwganNvbikge1xuICBsZXQgbWVyZ2VkID0gbnVsbDtcblxuICBpZiAoIWpzb25TY2hlbWEpIHtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIGlmICghanNvblNjaGVtYS5wcm9wZXJ0aWVzKSB7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICBjb25zdCBwcm9wTmFtZXMgPSBPYmplY3Qua2V5cyhqc29uU2NoZW1hLnByb3BlcnRpZXMpO1xuICAvLyBDaGVjayBlYWNoIHNjaGVtYSBwcm9wZXJ0eSBmb3IgZGVmYXVsdCB2YWx1ZS5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSBwcm9wTmFtZXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgY29uc3QgcHJvcE5hbWUgPSBwcm9wTmFtZXNbaV07XG4gICAgY29uc3QgcHJvcCA9IGpzb25TY2hlbWEucHJvcGVydGllc1twcm9wTmFtZV07XG5cbiAgICBpZiAoIV8uaGFzKGpzb24sIHByb3BOYW1lKSAmJiBfLmhhcyhwcm9wLCAnZGVmYXVsdCcpKSB7XG4gICAgICBpZiAobWVyZ2VkID09PSBudWxsKSB7XG4gICAgICAgIC8vIE9ubHkgdGFrZSBleHBlbnNpdmUgY2xvbmUgaWYgbmVlZGVkLlxuICAgICAgICBtZXJnZWQgPSBfLmNsb25lRGVlcChqc29uKTtcbiAgICAgIH1cblxuICAgICAgaWYgKF8uaXNPYmplY3QocHJvcC5kZWZhdWx0KSkge1xuICAgICAgICBtZXJnZWRbcHJvcE5hbWVdID0gXy5jbG9uZURlZXAocHJvcC5kZWZhdWx0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1lcmdlZFtwcm9wTmFtZV0gPSBwcm9wLmRlZmF1bHQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKG1lcmdlZCA9PT0gbnVsbCkge1xuICAgIHJldHVybiBqc29uO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBtZXJnZWQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gcGFyc2VWYWxpZGF0aW9uRXJyb3IoZXJyb3JzKSB7XG4gIGxldCBlcnJvckhhc2ggPSB7fTtcbiAgbGV0IGluZGV4ID0gMDtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGVycm9ycy5sZW5ndGg7ICsraSkge1xuICAgIGxldCBlcnJvciA9IGVycm9yc1tpXTtcbiAgICBsZXQga2V5ID0gZXJyb3IuZGF0YVBhdGguc3Vic3RyaW5nKDEpO1xuXG4gICAgaWYgKCFrZXkpIHtcbiAgICAgIGxldCBtYXRjaCA9IC9zaG91bGQgaGF2ZSByZXF1aXJlZCBwcm9wZXJ0eSAnKC4rKScvLmV4ZWMoZXJyb3IubWVzc2FnZSk7XG4gICAgICBpZiAobWF0Y2ggJiYgbWF0Y2gubGVuZ3RoID4gMSkge1xuICAgICAgICBrZXkgPSBtYXRjaFsxXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIWtleSAmJiBlcnJvci5wYXJhbXMgJiYgZXJyb3IucGFyYW1zLmFkZGl0aW9uYWxQcm9wZXJ0eSkge1xuICAgICAga2V5ID0gZXJyb3IucGFyYW1zLmFkZGl0aW9uYWxQcm9wZXJ0eTtcbiAgICB9XG5cbiAgICBpZiAoIWtleSkge1xuICAgICAga2V5ID0gKGluZGV4KyspLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgZXJyb3JIYXNoW2tleV0gPSBlcnJvci5tZXNzYWdlO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uRXJyb3IoZXJyb3JIYXNoKTtcbn1cblxuZnVuY3Rpb24gdG9Kc29uSW1wbChtb2RlbCwgY3JlYXRlRGJKc29uLCBvbWl0LCBwaWNrKSB7XG4gIGlmIChjcmVhdGVEYkpzb24pIHtcbiAgICByZXR1cm4gdG9EYXRhYmFzZUpzb25JbXBsKG1vZGVsLCBvbWl0LCBwaWNrKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdG9FeHRlcm5hbEpzb25JbXBsKG1vZGVsLCBvbWl0LCBwaWNrKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB0b0RhdGFiYXNlSnNvbkltcGwobW9kZWwsIG9taXQsIHBpY2spIHtcbiAgbGV0IGpzb24gPSB7fTtcbiAgY29uc3Qgb21pdEZyb21Kc29uID0gbW9kZWwuJG9taXRGcm9tRGF0YWJhc2VKc29uKCk7XG4gIGNvbnN0IHN0YXNoID0gbW9kZWwuJHN0YXNoZWRRdWVyeVByb3BzKCk7XG5cbiAgaWYgKHN0YXNoKSB7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHN0YXNoKTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBsID0ga2V5cy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgICBqc29uW2tleV0gPSBzdGFzaFtrZXldO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhtb2RlbCk7XG5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSBrZXlzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgYXNzaWduSnNvblZhbHVlKGpzb24sIGtleSwgbW9kZWxba2V5XSwgb21pdCwgcGljaywgb21pdEZyb21Kc29uLCB0cnVlKTtcbiAgfVxuXG4gIHJldHVybiBqc29uO1xufVxuXG5mdW5jdGlvbiB0b0V4dGVybmFsSnNvbkltcGwobW9kZWwsIG9taXQsIHBpY2spIHtcbiAgY29uc3QganNvbiA9IHt9O1xuICBjb25zdCBvbWl0RnJvbUpzb24gPSBtb2RlbC4kb21pdEZyb21Kc29uKCk7XG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhtb2RlbCk7XG5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSBrZXlzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgYXNzaWduSnNvblZhbHVlKGpzb24sIGtleSwgbW9kZWxba2V5XSwgb21pdCwgcGljaywgb21pdEZyb21Kc29uLCBmYWxzZSk7XG4gIH1cblxuICBpZiAobW9kZWwuY29uc3RydWN0b3IudmlydHVhbEF0dHJpYnV0ZXMpIHtcbiAgICBjb25zdCB2QXR0ciA9IG1vZGVsLmNvbnN0cnVjdG9yLnZpcnR1YWxBdHRyaWJ1dGVzO1xuXG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSB2QXR0ci5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgIGNvbnN0IGtleSA9IHZBdHRyW2ldO1xuICAgICAgbGV0IHZhbHVlID0gbW9kZWxba2V5XTtcblxuICAgICAgaWYgKF8uaXNGdW5jdGlvbih2YWx1ZSkpIHtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5jYWxsKG1vZGVsKTtcbiAgICAgIH1cblxuICAgICAgYXNzaWduSnNvblZhbHVlKGpzb24sIGtleSwgdmFsdWUsIG9taXQsIHBpY2ssIG9taXRGcm9tSnNvbiwgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBqc29uO1xufVxuXG5mdW5jdGlvbiBhc3NpZ25Kc29uVmFsdWUoanNvbiwga2V5LCB2YWx1ZSwgb21pdCwgcGljaywgb21pdEZyb21Kc29uLCBjcmVhdGVEYkpzb24pIHtcbiAgaWYgKGtleS5jaGFyQXQoMCkgIT09ICckJ1xuICAgICYmICFfLmlzRnVuY3Rpb24odmFsdWUpXG4gICAgJiYgIV8uaXNVbmRlZmluZWQodmFsdWUpXG4gICAgJiYgKCFvbWl0IHx8ICFvbWl0W2tleV0pXG4gICAgJiYgKCFwaWNrIHx8IHBpY2tba2V5XSlcbiAgICAmJiAoIW9taXRGcm9tSnNvbiB8fCAhY29udGFpbnMob21pdEZyb21Kc29uLCBrZXkpKSkge1xuXG4gICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGpzb25ba2V5XSA9IHRvSnNvbk9iamVjdCh2YWx1ZSwgY3JlYXRlRGJKc29uKTtcbiAgICB9IGVsc2Uge1xuICAgICAganNvbltrZXldID0gdmFsdWU7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHRvSnNvbk9iamVjdCh2YWx1ZSwgY3JlYXRlRGJKc29uKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIHJldHVybiB0b0pzb25BcnJheSh2YWx1ZSwgY3JlYXRlRGJKc29uKTtcbiAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE1vZGVsQmFzZSkge1xuICAgIGlmIChjcmVhdGVEYkpzb24pIHtcbiAgICAgIHJldHVybiB2YWx1ZS4kdG9EYXRhYmFzZUpzb24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHZhbHVlLiR0b0pzb24oKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoQnVmZmVyLmlzQnVmZmVyKHZhbHVlKSkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gXy5jbG9uZURlZXAodmFsdWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRvSnNvbkFycmF5KHZhbHVlLCBjcmVhdGVEYkpzb24pIHtcbiAgY29uc3QgcmV0ID0gbmV3IEFycmF5KHZhbHVlLmxlbmd0aCk7XG5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSByZXQubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgcmV0W2ldID0gdG9Kc29uT2JqZWN0KHZhbHVlW2ldLCBjcmVhdGVEYkpzb24pXG4gIH1cblxuICByZXR1cm4gcmV0O1xufVxuXG5mdW5jdGlvbiBjbG9uZU9iamVjdCh2YWx1ZSkge1xuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gY2xvbmVBcnJheSh2YWx1ZSk7XG4gIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBNb2RlbEJhc2UpIHtcbiAgICByZXR1cm4gdmFsdWUuJGNsb25lKCk7XG4gIH0gZWxzZSBpZiAoQnVmZmVyLmlzQnVmZmVyKHZhbHVlKSkge1xuICAgIHJldHVybiBuZXcgQnVmZmVyKHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gXy5jbG9uZURlZXAodmFsdWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNsb25lQXJyYXkodmFsdWUpIHtcbiAgY29uc3QgcmV0ID0gbmV3IEFycmF5KHZhbHVlLmxlbmd0aCk7XG5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSByZXQubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgcmV0W2ldID0gY2xvbmVPYmplY3QodmFsdWVbaV0pXG4gIH1cblxuICByZXR1cm4gcmV0O1xufVxuXG5mdW5jdGlvbiBvbWl0T2JqZWN0KG1vZGVsLCBrZXlPYmopIHtcbiAgY29uc3QgTW9kZWxDbGFzcyA9IG1vZGVsLmNvbnN0cnVjdG9yO1xuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoa2V5T2JqKTtcblxuICBmb3IgKGxldCBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcbiAgICBjb25zdCB2YWx1ZSA9IGtleU9ialtrZXldO1xuXG4gICAgaWYgKHZhbHVlICYmIGtleS5jaGFyQXQoMCkgIT09ICckJyAmJiBfLmhhcyhtb2RlbCwga2V5KSkge1xuICAgICAgTW9kZWxDbGFzcy5vbWl0SW1wbChtb2RlbCwga2V5KTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gb21pdEFycmF5KG1vZGVsLCBrZXlzKSB7XG4gIGNvbnN0IE1vZGVsQ2xhc3MgPSBtb2RlbC5jb25zdHJ1Y3RvcjtcblxuICBmb3IgKGxldCBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcblxuICAgIGlmIChrZXkuY2hhckF0KDApICE9PSAnJCcgJiYgXy5oYXMobW9kZWwsIGtleSkpIHtcbiAgICAgIE1vZGVsQ2xhc3Mub21pdEltcGwobW9kZWwsIGtleSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHBpY2tPYmplY3QobW9kZWwsIGtleU9iaikge1xuICBjb25zdCBNb2RlbENsYXNzID0gbW9kZWwuY29uc3RydWN0b3I7XG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhtb2RlbCk7XG5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSBrZXlzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG5cbiAgICBpZiAoa2V5LmNoYXJBdCgwKSAhPT0gJyQnICYmICFrZXlPYmpba2V5XSkge1xuICAgICAgTW9kZWxDbGFzcy5vbWl0SW1wbChtb2RlbCwga2V5KTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gcGlja0FycmF5KG1vZGVsLCBwaWNrKSB7XG4gIGNvbnN0IE1vZGVsQ2xhc3MgPSBtb2RlbC5jb25zdHJ1Y3RvcjtcbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG1vZGVsKTtcblxuICBmb3IgKGxldCBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcblxuICAgIGlmIChrZXkuY2hhckF0KDApICE9PSAnJCcgJiYgIWNvbnRhaW5zKHBpY2ssIGtleSkpIHtcbiAgICAgIE1vZGVsQ2xhc3Mub21pdEltcGwobW9kZWwsIGtleSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvbnRhaW5zKGFyciwgdmFsdWUpIHtcbiAgZm9yIChsZXQgaSA9IDAsIGwgPSBhcnIubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgaWYgKGFycltpXSA9PT0gdmFsdWUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGNvbXBpbGVKc29uU2NoZW1hVmFsaWRhdG9yKGpzb25TY2hlbWEsIHNraXBSZXF1aXJlZCkge1xuICBsZXQgb3JpZ1JlcXVpcmVkO1xuXG4gIHRyeSB7XG4gICAgaWYgKHNraXBSZXF1aXJlZCkge1xuICAgICAgb3JpZ1JlcXVpcmVkID0ganNvblNjaGVtYS5yZXF1aXJlZDtcbiAgICAgIGpzb25TY2hlbWEucmVxdWlyZWQgPSBbXTtcbiAgICB9XG5cbiAgICByZXR1cm4gYWp2LmNvbXBpbGUoanNvblNjaGVtYSk7XG4gIH0gZmluYWxseSB7XG4gICAgaWYgKHNraXBSZXF1aXJlZCkge1xuICAgICAganNvblNjaGVtYS5yZXF1aXJlZCA9IG9yaWdSZXF1aXJlZDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==