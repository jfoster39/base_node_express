'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _create = require('babel-runtime/core-js/object/create');

var _create2 = _interopRequireDefault(_create);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _FindOperation2 = require('../../queryBuilder/operations/FindOperation');

var _FindOperation3 = _interopRequireDefault(_FindOperation2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ownerJoinColumnAliasPrefix = 'objectiontmpjoin';

var ManyToManyFindOperation = function (_FindOperation) {
  (0, _inherits3.default)(ManyToManyFindOperation, _FindOperation);

  function ManyToManyFindOperation(name, opt) {
    (0, _classCallCheck3.default)(this, ManyToManyFindOperation);

    var _this = (0, _possibleConstructorReturn3.default)(this, _FindOperation.call(this, name, opt));

    _this.relation = opt.relation;
    _this.owners = opt.owners;

    _this.relatedIdxByOwnerId = null;
    _this.ownerJoinColumnAlias = new Array(_this.relation.joinTableOwnerCol.length);

    for (var i = 0, l = _this.relation.joinTableOwnerCol.length; i < l; ++i) {
      _this.ownerJoinColumnAlias[i] = ownerJoinColumnAliasPrefix + i;
    }
    return _this;
  }

  ManyToManyFindOperation.prototype.onBeforeBuild = function onBeforeBuild(builder) {
    var ids = new Array(this.owners.length);

    for (var i = 0, l = this.owners.length; i < l; ++i) {
      ids[i] = this.owners[i].$values(this.relation.ownerProp);
    }

    if (!builder.has(/select/)) {
      // If the user hasn't specified a select clause, select the related model's columns.
      // If we don't do this we also get the join table's columns.
      builder.select(this.relation.relatedModelClass.tableName + '.*');

      var extraCols = this.relation.fullJoinTableExtraCols();
      // Also select all extra columns.
      for (var _i = 0, _l = extraCols.length; _i < _l; ++_i) {
        builder.select(extraCols[_i]);
      }
    }

    this.relation.findQuery(builder, {
      ownerIds: _lodash2.default.uniqBy(ids, join)
    });

    var fullJoinTableOwnerCol = this.relation.fullJoinTableOwnerCol();
    // We must select the owner join columns so that we know for which owner model the related
    // models belong to after the requests.
    for (var _i2 = 0, _l2 = fullJoinTableOwnerCol.length; _i2 < _l2; ++_i2) {
      builder.select(fullJoinTableOwnerCol[_i2] + ' as ' + this.ownerJoinColumnAlias[_i2]);
    }
  };

  ManyToManyFindOperation.prototype.onRawResult = function onRawResult(builder, rows) {
    var relatedIdxByOwnerId = (0, _create2.default)(null);
    var propKey = this.relation.relatedModelClass.prototype.$propKey;

    for (var i = 0, l = rows.length; i < l; ++i) {
      var row = rows[i];
      var key = propKey.call(row, this.ownerJoinColumnAlias);
      var arr = relatedIdxByOwnerId[key];

      if (!arr) {
        arr = [];
        relatedIdxByOwnerId[key] = arr;
      }

      for (var j = 0, lc = this.ownerJoinColumnAlias.length; j < lc; ++j) {
        delete row[this.ownerJoinColumnAlias[j]];
      }

      arr.push(i);
    }

    this.relatedIdxByOwnerId = relatedIdxByOwnerId;
    return rows;
  };

  ManyToManyFindOperation.prototype.onAfterInternal = function onAfterInternal(builder, related) {
    for (var i = 0, l = this.owners.length; i < l; ++i) {
      var own = this.owners[i];
      var key = own.$propKey(this.relation.ownerProp);
      var idx = this.relatedIdxByOwnerId[key];

      if (idx) {
        var arr = new Array(idx.length);

        for (var j = 0, lr = idx.length; j < lr; ++j) {
          arr[j] = related[idx[j]];
        }

        own[this.relation.name] = arr;
      } else {
        own[this.relation.name] = [];
      }
    }

    return related;
  };

  return ManyToManyFindOperation;
}(_FindOperation3.default);

exports.default = ManyToManyFindOperation;


function join(arr) {
  return arr.join();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1hbnlUb01hbnlGaW5kT3BlcmF0aW9uLmpzIl0sIm5hbWVzIjpbIm93bmVySm9pbkNvbHVtbkFsaWFzUHJlZml4IiwiTWFueVRvTWFueUZpbmRPcGVyYXRpb24iLCJuYW1lIiwib3B0IiwicmVsYXRpb24iLCJvd25lcnMiLCJyZWxhdGVkSWR4QnlPd25lcklkIiwib3duZXJKb2luQ29sdW1uQWxpYXMiLCJBcnJheSIsImpvaW5UYWJsZU93bmVyQ29sIiwibGVuZ3RoIiwiaSIsImwiLCJvbkJlZm9yZUJ1aWxkIiwiYnVpbGRlciIsImlkcyIsIiR2YWx1ZXMiLCJvd25lclByb3AiLCJoYXMiLCJzZWxlY3QiLCJyZWxhdGVkTW9kZWxDbGFzcyIsInRhYmxlTmFtZSIsImV4dHJhQ29scyIsImZ1bGxKb2luVGFibGVFeHRyYUNvbHMiLCJmaW5kUXVlcnkiLCJvd25lcklkcyIsInVuaXFCeSIsImpvaW4iLCJmdWxsSm9pblRhYmxlT3duZXJDb2wiLCJvblJhd1Jlc3VsdCIsInJvd3MiLCJwcm9wS2V5IiwicHJvdG90eXBlIiwiJHByb3BLZXkiLCJyb3ciLCJrZXkiLCJjYWxsIiwiYXJyIiwiaiIsImxjIiwicHVzaCIsIm9uQWZ0ZXJJbnRlcm5hbCIsInJlbGF0ZWQiLCJvd24iLCJpZHgiLCJsciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7Ozs7QUFFQSxJQUFNQSw2QkFBNkIsa0JBQW5DOztJQUVxQkMsdUI7OztBQUVuQixtQ0FBWUMsSUFBWixFQUFrQkMsR0FBbEIsRUFBdUI7QUFBQTs7QUFBQSwrREFDckIsMEJBQU1ELElBQU4sRUFBWUMsR0FBWixDQURxQjs7QUFHckIsVUFBS0MsUUFBTCxHQUFnQkQsSUFBSUMsUUFBcEI7QUFDQSxVQUFLQyxNQUFMLEdBQWNGLElBQUlFLE1BQWxCOztBQUVBLFVBQUtDLG1CQUFMLEdBQTJCLElBQTNCO0FBQ0EsVUFBS0Msb0JBQUwsR0FBNEIsSUFBSUMsS0FBSixDQUFVLE1B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aW5kT3BlcmF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBGaW5kT3BlcmF0aW9uIGZyb20gJy4uLy4uL3F1ZXJ5QnVpbGRlci9vcGVyYXRpb25zL0ZpbmRPcGVyYXRpb24nO1xuXG5jb25zdCBvd25lckpvaW5Db2x1bW5BbGlhc1ByZWZpeCA9ICdvYmplY3Rpb250bXBqb2luJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWFueVRvTWFueUZpbmRPcGVyYXRpb24gZXh0ZW5kcyBGaW5kT3BlcmF0aW9uIHtcblxuICBjb25zdHJ1Y3RvcihuYW1lLCBvcHQpIHtcbiAgICBzdXBlcihuYW1lLCBvcHQpO1xuXG4gICAgdGhpcy5yZWxhdGlvbiA9IG9wdC5yZWxhdGlvbjtcbiAgICB0aGlzLm93bmVycyA9IG9wdC5vd25lcnM7XG5cbiAgICB0aGlzLnJlbGF0ZWRJZHhCeU93bmVySWQgPSBudWxsO1xuICAgIHRoaXMub3duZXJKb2luQ29sdW1uQWxpYXMgPSBuZXcgQXJyYXkodGhpcy5yZWxhdGlvbi5qb2luVGFibGVPd25lckNvbC5sZW5ndGgpO1xuXG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLnJlbGF0aW9uLmpvaW5UYWJsZU93bmVyQ29sLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgdGhpcy5vd25lckpvaW5Db2x1bW5BbGlhc1tpXSA9IG93bmVySm9pbkNvbHVtbkFsaWFzUHJlZml4ICsgaTtcbiAgICB9XG4gIH1cblxuICBvbkJlZm9yZUJ1aWxkKGJ1aWxkZXIpIHtcbiAgICBjb25zdCBpZHMgPSBuZXcgQXJyYXkodGhpcy5vd25lcnMubGVuZ3RoKTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5vd25lcnMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICBpZHNbaV0gPSB0aGlzLm93bmVyc1tpXS4kdmFsdWVzKHRoaXMucmVsYXRpb24ub3duZXJQcm9wKTtcbiAgICB9XG5cbiAgICBpZiAoIWJ1aWxkZXIuaGFzKC9zZWxlY3QvKSkge1xuICAgICAgLy8gSWYgdGhlIHVzZXIgaGFzbid0IHNwZWNpZmllZCBhIHNlbGVjdCBjbGF1c2UsIHNlbGVjdCB0aGUgcmVsYXRlZCBtb2RlbCdzIGNvbHVtbnMuXG4gICAgICAvLyBJZiB3ZSBkb24ndCBkbyB0aGlzIHdlIGFsc28gZ2V0IHRoZSBqb2luIHRhYmxlJ3MgY29sdW1ucy5cbiAgICAgIGJ1aWxkZXIuc2VsZWN0KHRoaXMucmVsYXRpb24ucmVsYXRlZE1vZGVsQ2xhc3MudGFibGVOYW1lICsgJy4qJyk7XG5cbiAgICAgIGNvbnN0IGV4dHJhQ29scyA9IHRoaXMucmVsYXRpb24uZnVsbEpvaW5UYWJsZUV4dHJhQ29scygpO1xuICAgICAgLy8gQWxzbyBzZWxlY3QgYWxsIGV4dHJhIGNvbHVtbnMuXG4gICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGV4dHJhQ29scy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgICAgYnVpbGRlci5zZWxlY3QoZXh0cmFDb2xzW2ldKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnJlbGF0aW9uLmZpbmRRdWVyeShidWlsZGVyLCB7XG4gICAgICBvd25lcklkczogXy51bmlxQnkoaWRzLCBqb2luKVxuICAgIH0pO1xuXG4gICAgY29uc3QgZnVsbEpvaW5UYWJsZU93bmVyQ29sID0gdGhpcy5yZWxhdGlvbi5mdWxsSm9pblRhYmxlT3duZXJDb2woKTtcbiAgICAvLyBXZSBtdXN0IHNlbGVjdCB0aGUgb3duZXIgam9pbiBjb2x1bW5zIHNvIHRoYXQgd2Uga25vdyBmb3Igd2hpY2ggb3duZXIgbW9kZWwgdGhlIHJlbGF0ZWRcbiAgICAvLyBtb2RlbHMgYmVsb25nIHRvIGFmdGVyIHRoZSByZXF1ZXN0cy5cbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IGZ1bGxKb2luVGFibGVPd25lckNvbC5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgIGJ1aWxkZXIuc2VsZWN0KGZ1bGxKb2luVGFibGVPd25lckNvbFtpXSArICcgYXMgJyArIHRoaXMub3duZXJKb2luQ29sdW1uQWxpYXNbaV0pO1xuICAgIH1cbiAgfVxuXG4gIG9uUmF3UmVzdWx0KGJ1aWxkZXIsIHJvd3MpIHtcbiAgICBjb25zdCByZWxhdGVkSWR4QnlPd25lcklkID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICBjb25zdCBwcm9wS2V5ID0gdGhpcy5yZWxhdGlvbi5yZWxhdGVkTW9kZWxDbGFzcy5wcm90b3R5cGUuJHByb3BLZXk7XG5cbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJvd3MubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICBjb25zdCByb3cgPSByb3dzW2ldO1xuICAgICAgY29uc3Qga2V5ID0gcHJvcEtleS5jYWxsKHJvdywgdGhpcy5vd25lckpvaW5Db2x1bW5BbGlhcyk7XG4gICAgICBsZXQgYXJyID0gcmVsYXRlZElkeEJ5T3duZXJJZFtrZXldO1xuXG4gICAgICBpZiAoIWFycikge1xuICAgICAgICBhcnIgPSBbXTtcbiAgICAgICAgcmVsYXRlZElkeEJ5T3duZXJJZFtrZXldID0gYXJyO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBqID0gMCwgbGMgPSB0aGlzLm93bmVySm9pbkNvbHVtbkFsaWFzLmxlbmd0aDsgaiA8IGxjOyArK2opIHtcbiAgICAgICAgZGVsZXRlIHJvd1t0aGlzLm93bmVySm9pbkNvbHVtbkFsaWFzW2pdXTtcbiAgICAgIH1cblxuICAgICAgYXJyLnB1c2goaSk7XG4gICAgfVxuXG4gICAgdGhpcy5yZWxhdGVkSWR4QnlPd25lcklkID0gcmVsYXRlZElkeEJ5T3duZXJJZDtcbiAgICByZXR1cm4gcm93cztcbiAgfVxuXG4gIG9uQWZ0ZXJJbnRlcm5hbChidWlsZGVyLCByZWxhdGVkKSB7XG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLm93bmVycy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgIGNvbnN0IG93biA9IHRoaXMub3duZXJzW2ldO1xuICAgICAgY29uc3Qga2V5ID0gb3duLiRwcm9wS2V5KHRoaXMucmVsYXRpb24ub3duZXJQcm9wKTtcbiAgICAgIGNvbnN0IGlkeCA9IHRoaXMucmVsYXRlZElkeEJ5T3duZXJJZFtrZXldO1xuXG4gICAgICBpZiAoaWR4KSB7XG4gICAgICAgIGNvbnN0IGFyciA9IG5ldyBBcnJheShpZHgubGVuZ3RoKTtcblxuICAgICAgICBmb3IgKGxldCBqID0gMCwgbHIgPSBpZHgubGVuZ3RoOyBqIDwgbHI7ICsraikge1xuICAgICAgICAgIGFycltqXSA9IHJlbGF0ZWRbaWR4W2pdXTtcbiAgICAgICAgfVxuXG4gICAgICAgIG93blt0aGlzLnJlbGF0aW9uLm5hbWVdID0gYXJyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3duW3RoaXMucmVsYXRpb24ubmFtZV0gPSBbXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVsYXRlZDtcbiAgfVxufVxuXG5mdW5jdGlvbiBqb2luKGFycikge1xuICByZXR1cm4gYXJyLmpvaW4oKTtcbn0iXX0=